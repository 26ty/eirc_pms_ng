<div class="container">
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">

                    <li class="breadcrumb-item"><a href="/main/dashboard" class="a-blue">首頁</a></li>
                    <li class="breadcrumb-item active"><a href="/main/project-C/project-info-manufacture-order-list"
                            class="a-blue">製造資訊管理</a></li>
                    <li class="breadcrumb-item active" aria-current="page">製令開啟通知作業</li>
                </ol>
            </nav>
        </div>
    </div>
    <!-- <div class="row">
        <div class="col-md-12 text-center">
            <div class="left">
                <h1>
                    <mat-icon>description</mat-icon>
                    <span class="text-left">
                        製令開啟通知作業-修改
                    </span>
                </h1>
            </div>
        </div>
    </div> -->
    <mat-card class="card">
        <form [formGroup]="receiptForm">
            <div class="row edit-none-group" *ngIf="Datas">
                <div class="col-md-6 text-left">
                    <div class="pt-0 pb-0">
                        <div class="">
                            <div class="form-box">

                                <mat-list>
                                    <table cellspacing="0" class="width100">
                                        <tr>
                                            <td>
                                                <mat-list-item *ngIf="Datas.body.customer_demand_code">
                                                    <h4 class="text-head">客需代號： </h4>
                                                    <h4>{{Datas.body.customer_demand_code}}</h4>
                                                </mat-list-item>
                                                <mat-list-item *ngIf="Datas.body.project_code">
                                                    <h4 class="text-head">專案代號： </h4>
                                                    <h4>{{Datas.body.project_code}}</h4>
                                                </mat-list-item>
                                            </td>

                                            <mat-list>
                                                <mat-list-item>
                                                    <h4 class="text-head">單號：</h4>
                                                    <h4>{{Datas.body.code}}</h4>
                                                </mat-list-item>
                                            </mat-list>
                                        </tr>
                                    </table>
                                </mat-list>


                                <mat-form-field appearance="outline" class="width100">
                                    <mat-label>專案代號</mat-label>
                                    <input matInput type="text" [(ngModel)]="Datas.body.project_detail"
                                        formControlName="project_detail" name="project_detail" ngDefaultControl
                                        [readonly]="Datas.body.bonita_case_id">
                                </mat-form-field>

                                <table cellspacing="0" class="width100">
                                    <tr>
                                        <td>
                                            <mat-form-field appearance="outline" class="width100">
                                                <mat-label>主件品號</mat-label>
                                                <input matInput type="text" [(ngModel)]="Datas.body.order_name"
                                                    formControlName="order_name" name="order_name" ngDefaultControl
                                                    required [readonly]="Datas.body.bonita_case_id">
                                            </mat-form-field>
                                        </td>
                                        <td>
                                            <mat-form-field appearance="outline" class="width100">
                                                <mat-label>需求數量</mat-label>
                                                <input matInput type="number" [(ngModel)]="Datas.body.amount"
                                                    formControlName="amount" name="amount" ngDefaultControl required
                                                    [readonly]="Datas.body.bonita_case_id" min="0">
                                            </mat-form-field>
                                        </td>
                                    </tr>
                                </table>

                                <mat-form-field class="example-form-field" appearance="outline" class="width100">
                                    <mat-label>製令開啟~關閉</mat-label>
                                    <mat-date-range-input [formGroup]="campaignOne" [rangePicker]="campaignOnePicker"
                                        required [disabled]="Datas.body.bonita_case_id">
                                        <input matStartDate [(ngModel)]="Datas.body.date_for_open"
                                            formControlName="date_for_open" name="date_for_open"
                                            placeholder="Start date" formControlName="start">
                                        <input matEndDate [(ngModel)]="Datas.body.date_for_close"
                                            formControlName="date_for_close" name="date_for_close"
                                            placeholder="End date" formControlName="end">
                                    </mat-date-range-input>
                                    <mat-datepicker-toggle matSuffix [for]="campaignOnePicker"></mat-datepicker-toggle>
                                    <mat-date-range-picker #campaignOnePicker></mat-date-range-picker>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="width100">
                                    <mat-label>備註</mat-label>
                                    <textarea matInput type="text" [(ngModel)]="Datas.body.remark" placeholder="請說明開單事由"
                                        formControlName="remark" name="remark" ngDefaultControl required
                                        pTooltip="請說明開單事由" [readonly]="Datas.body.bonita_case_id"></textarea>
                                </mat-form-field>

                                <!--客戶-->
                                <mat-form-field appearance="outline" class="width100">
                                    <!-- <mat-label>客戶</mat-label> -->
                                    <mat-label>客戶(需外串客戶資料庫)</mat-label>
                                    <mat-select [(ngModel)]="Datas.body.customer_id" formControlName="customer_id"
                                        name="customer_id" ngDefaultControl [disabled]="Datas.body.bonita_case_id">
                                        <!-- <mat-optgroup class="option-30" *ngFor="let group of accountgroup"
                                            [label]="group.name" [disabled]="group.disabled">
                                            <mat-option class="option-30" *ngFor="let account of group.account"
                                                [value]="account.account_id">
                                                {{account.name}}
                                            </mat-option>
                                        </mat-optgroup> -->
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="width100">
                                    <mat-label>出貨地點</mat-label>
                                    <textarea matInput type="text" [(ngModel)]="Datas.body.shipment_location"
                                        formControlName="shipment_location" name="shipment_location" ngDefaultControl
                                        [readonly]="Datas.body.bonita_case_id"></textarea>
                                </mat-form-field>



                                <table cellspacing="0" class="width100">
                                    <tr>
                                        <td>
                                            <mat-form-field appearance="outline" class="width100">
                                                <mat-label>預計出貨</mat-label>
                                                <input matInput [matDatepicker]="picker_done"
                                                    [(ngModel)]="Datas.body.date_for_estimated_shipment"
                                                    formControlName="date_for_estimated_shipment"
                                                    name="date_for_estimated_shipment" ngDefaultControl
                                                    [disabled]="Datas.body.bonita_case_id">
                                                <mat-datepicker-toggle matSuffix [for]="picker_done">
                                                </mat-datepicker-toggle>
                                                <mat-datepicker #picker_done></mat-datepicker>
                                                <mat-error>
                                                    必填
                                                </mat-error>
                                            </mat-form-field>
                                        </td>
                                        <td>
                                            <mat-form-field appearance="outline" class="width100">
                                                <mat-label>內部訂單編號</mat-label>
                                                <textarea matInput type="text" [(ngModel)]="Datas.body.inner_id"
                                                    formControlName="inner_id" name="inner_id" ngDefaultControl
                                                    [readonly]="Datas.body.bonita_case_id"></textarea>
                                            </mat-form-field>
                                        </td>
                                    </tr>
                                </table>

                                <mat-form-field appearance="outline" class="width100">
                                    <mat-label>其他相關單據</mat-label>
                                    <input matInput type="text" [(ngModel)]="Datas.body.other_document_code"
                                        formControlName="other_document_code" name="other_document_code"
                                        ngDefaultControl [readonly]="Datas.body.bonita_case_id">
                                </mat-form-field>



                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-md-6 text-left">
                    <div class="pt-0 pb-0">
                        <mat-tab-group dynamicHeight>
                            <mat-tab label="收/發文">
                                <div class="container">

                                    <mat-list>
                                        <table class="example-full-width" cellspacing="0">
                                            <tr>
                                                <td>
                                                    <mat-list-item>
                                                        <h4 class="text-head"> 發文者: </h4>
                                                        <h4> {{Datas.body.creater_name}}</h4>
                                                    </mat-list-item>
                                                </td>
                                                <td>
                                                    <mat-list-item>
                                                        <h4 class="text-head">發文單位: </h4>
                                                        <h4> 營運業務部 </h4>
                                                    </mat-list-item>
                                                </td>
                                            </tr>
                                        </table>
                                        <mat-list-item style="height: 80px;">
                                            <mat-form-field appearance="outline" style="width: 100%">
                                                <mat-label>業務助理</mat-label>
                                                <mat-select [(ngModel)]="Datas.body.sales_assistant_id"
                                                    formControlName="sales_assistant_id" name="sales_assistant_id"
                                                    ngDefaultControl required>
                                                    <mat-optgroup class="option-30" *ngFor="let group of accountgroup"
                                                        [label]="group.name" [disabled]="group.disabled">
                                                        <mat-option class="option-30"
                                                            *ngFor="let account of group.account"
                                                            [value]="account.account_id">
                                                            {{account.name}}
                                                        </mat-option>
                                                    </mat-optgroup>
                                                </mat-select>
                                            </mat-form-field>
                                        </mat-list-item>
                                        <mat-list-item style="height: 80px;">
                                            <mat-form-field appearance="outline" style="width: 100%">
                                                <mat-label>收文者</mat-label>
                                                <mat-select [(ngModel)]="Datas.body.recipient_id"
                                                    formControlName="recipient_id" name="recipient_id" ngDefaultControl
                                                    required>
                                                    <mat-optgroup class="option-30" *ngFor="let group of accountgroup"
                                                        [label]="group.name" [disabled]="group.disabled">
                                                        <mat-option class="option-30"
                                                            *ngFor="let account of group.account"
                                                            [value]="account.account_id">
                                                            {{account.name}}
                                                        </mat-option>
                                                    </mat-optgroup>
                                                </mat-select>
                                            </mat-form-field>
                                        </mat-list-item>
                                        <mat-list-item style="height: 80px;">
                                            <mat-form-field appearance="outline" style="width: 100%">
                                                <mat-label>業務負責人</mat-label>
                                                <mat-select [(ngModel)]="Datas.body.salesman_id"
                                                    formControlName="salesman_id" name="salesman_id" ngDefaultControl
                                                    required>
                                                    <mat-optgroup class="option-30" *ngFor="let group of accountgroup"
                                                        [label]="group.name" [disabled]="group.disabled">
                                                        <mat-option class="option-30"
                                                            *ngFor="let account of group.account"
                                                            [value]="account.account_id">
                                                            {{account.name}}
                                                        </mat-option>
                                                    </mat-optgroup>
                                                </mat-select>
                                            </mat-form-field>
                                        </mat-list-item>
                                        <mat-list-item>
                                            <h4 class="text-head">
                                                <a (click)="authItem(m_id)">
                                                    <u class="text-head">副本: </u>
                                                </a>
                                                <span *ngFor="let item of taskUserList;let index = index">
                                                    {{item}}、
                                                </span>
                                            </h4>

                                        </mat-list-item>
                                    </mat-list>
                                </div>
                            </mat-tab>
                            <mat-tab label="審核">

                                <!-- <mat-list>
                                    <mat-list-item>
                                        <h4 class="text-head">單位主管：</h4>
                                        <h4 *ngIf="department_interview[0]">{{department_interview[0].creater_name}}
                                            {{department_interview[0].create_time | date:
                                            'yyyy/MM/dd hh:mm'}}</h4>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <h4 class="text-head">核准人員： </h4>
                                        <h4 *ngIf="department_interview[1]">{{department_interview[1].creater_name}}
                                            {{department_interview[1].create_time | date:
                                            'yyyy/MM/dd hh:mm'}}</h4>
                                    </mat-list-item>
                                    <mat-list-item>
                                        <h4 class="text-head">收文人員： </h4>
                                        <h4 *ngIf="department_interview[2]">{{department_interview[2].creater_name}}
                                            {{department_interview[2].create_time | date:
                                            'yyyy/MM/dd hh:mm'}}</h4>
                                    </mat-list-item>
                                </mat-list> -->

                                <div class="col mt-3">
                                    <dl class="row">
                                        <dt class="px-0 col-sm-2">
                                            <h4 class="text-head text-right">單位主管: </h4>
                                        </dt>
                                        <dd class="col-sm-10">
                                            <h4 *ngIf="department_interview[0]">
                                                {{department_interview[0].creater_name}}
                                                {{department_interview[0].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ">
                                            <h4 class="text-head text-right">核准人員: </h4>
                                        </dt>
                                        <dd class="col-sm-10">
                                            <h4 *ngIf="department_interview[1]">
                                                {{department_interview[1].creater_name}}
                                                {{department_interview[1].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ">
                                            <h4 class="text-head text-right">收文人員:</h4>
                                        </dt>
                                        <dd class="col-sm-10">
                                            <h4 *ngIf="department_interview[2]">
                                                {{department_interview[2].creater_name}}
                                                {{department_interview[2].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>

                                    </dl>
                                </div>

                            </mat-tab>
                            <mat-tab label="ERP">

                            </mat-tab>
                            <mat-tab label="相關紀錄">
                                <!--資料顯示區-->
                                <div class="container">
                                    <div class="row">
                                        <div class="col-md-12">
                                            <div class="table-container">
                                                <div class="table">
                                                    <table #interviewSortSort='matSort' matSort mat-table
                                                        [dataSource]="interviewDataSource" class="mat-elevation-z8">

                                                        <ng-container matColumnDef="content">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 動作
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.actor}}{{element.content}}
                                                            </td>
                                                        </ng-container>

                                                        <!-- remark Column -->
                                                        <ng-container matColumnDef="remark">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 備註說明
                                                            </th>
                                                            <td mat-cell *matCellDef="let element"> {{element.remark}}
                                                            </td>
                                                        </ng-container>

                                                        <!-- name Column -->
                                                        <ng-container matColumnDef="creater_name">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 人員
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.creater_name}}
                                                            </td>
                                                        </ng-container>

                                                        <!-- creatTime Column -->
                                                        <ng-container matColumnDef="create_time">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 創建時間
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.create_time | date:
                                                                'yyyy/MM/dd hh:mm'}}
                                                            </td>
                                                        </ng-container>

                                                        <tr mat-header-row *matHeaderRowDef="interviewcol"></tr>
                                                        <tr mat-row *matRowDef="let row; columns: interviewcol;"></tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>


                            </mat-tab>
                        </mat-tab-group>
                    </div>
                </div>
                <div class="row pt-3">
                    <div class="col-md-12 text-center">
                        <!-- <button mat-button class="btn" (click)="startC2Bonita(receiptForm.valid)" matTooltip="送審">
                            送審
                        </button> -->

                        <button mat-button class="btn-normal" (click)="deleteProjectInfoManufacturet()"
                            [hidden]="Datas.body.bonita_case_id || permission" matTooltip="刪除">
                            刪除
                        </button>
                        <button mat-button class="btn" (click)="updateProjectInfoManufacture('編輯中')"
                            [hidden]="Datas.body.bonita_case_id || permission" matTooltip="儲存">
                            儲存
                        </button>

                        <button mat-raised-button class="btn-green" [hidden]="Datas.body.bonita_case_id || permission"
                            (click)="startC2Bonita();">送審</button>
                        <button mat-raised-button class="btn-green" *ngIf="restart_task_id"
                            (click)="resubmitCase();">重新送審</button>

                    </div>
                </div>
            </div>
        </form>
    </mat-card>