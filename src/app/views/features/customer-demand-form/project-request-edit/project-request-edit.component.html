<div class="container">
    <div class="row">
        <div class="col-md-12 pb-3">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/main/dashboard" class="a-blue">首頁</a></li>
                    <li class="breadcrumb-item active"><a href="/main/project-A/project-request"
                            class="a-blue">客需單管理</a></li>
                    <li class="breadcrumb-item active"><a>客需單管理作業-修改</a></li>
                </ol>
            </nav>
            <!-- <p-breadcrumb [model]="items" [home]="home"></p-breadcrumb> -->
        </div>
    </div>
    <!-- <div class="row">
        <div class="col-md-12 text-center">
            <div class="left">
                <h1>
                    <mat-icon>description</mat-icon>
                    <span class="text-left">
                        客需單管理作業-修改
                    </span>
                </h1>
            </div>
        </div>
    </div> -->

    <mat-card class="card search-group">
        <mat-tab-group dynamicHeight>
            <!--tab:客需單內容-->
            <mat-tab label="單據內容與審核資料">

                <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h5>客需單申請作業</h5>
                        </div>
                    </div>
                    <!--內容顯示-->
                    <div class="row edit-none-group">
                        <div class="col-md-7 text-left">
                            <div class="pt-0 pb-0">
                                <div class="container">
                                    <div class="edit-form-group" *ngIf="CRDatas">
                                        <div>
                                            <form [formGroup]="receiptForm">

                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--單號-->
                                                            <h2>
                                                                <b>
                                                                    {{CRDatas.body.code}}
                                                                </b>
                                                            </h2>
                                                        </td>
                                                        <td>
                                                            <!--日期-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>日期</mat-label>
                                                                <input matInput [matDatepicker]="customerDatePicker"
                                                                    [(ngModel)]="CRDatas.body.date_for_recive"
                                                                    formControlName="date_for_recive"
                                                                    name="date_for_recive" required
                                                                    [disabled]="CRDatas.body.bonita_case_id">
                                                                <mat-datepicker-toggle matSuffix
                                                                    [for]="customerDatePicker">
                                                                </mat-datepicker-toggle>
                                                                <mat-datepicker #customerDatePicker></mat-datepicker>
                                                            </mat-form-field>
                                                        </td>

                                                    </tr>
                                                </table>



                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--客戶-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <!-- <mat-label>客戶</mat-label> -->
                                                                <mat-label>客戶(需外串客戶資料庫)</mat-label>
                                                                <mat-select [(ngModel)]="CRDatas.body.customer_id"
                                                                    formControlName="customer_id" name="customer_id"
                                                                    ngDefaultControl required [disabled]="true">
                                                                    <!-- <mat-optgroup class="option-30"
                                                                        *ngFor="let group of accountgroup"
                                                                        [label]="group.name"
                                                                        [disabled]="group.disabled">
                                                                        <mat-option class="option-30"
                                                                            *ngFor="let account of group.account"
                                                                            [value]="account.account_id">
                                                                            {{account.name}}
                                                                        </mat-option>
                                                                    </mat-optgroup> -->
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </td>
                                                        <td>
                                                            <!--客戶聯絡人-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>客戶聯絡人</mat-label>
                                                                <mat-select [(ngModel)]="CRDatas.body.contact_person_id"
                                                                    formControlName="contact_person_id"
                                                                    name="contact_person_id" ngDefaultControl required
                                                                    [disabled]="CRDatas.body.bonita_case_id">
                                                                    <mat-optgroup class="option-30"
                                                                        *ngFor="let group of accountgroup"
                                                                        [label]="group.name"
                                                                        [disabled]="group.disabled">
                                                                        <mat-option class="option-30"
                                                                            *ngFor="let account of group.account"
                                                                            [value]="account.account_id">
                                                                            {{account.name}}
                                                                        </mat-option>
                                                                    </mat-optgroup>
                                                                </mat-select>
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                </table>

                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--電話-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>電話</mat-label>
                                                                <input matInput type="text" ngDefaultControl required
                                                                    disabled [readonly]="CRDatas.body.bonita_case_id">
                                                            </mat-form-field>
                                                        </td>
                                                        <td>
                                                            <!--電子郵件-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>Email</mat-label>
                                                                <input matInput placeholder="請輸入電子郵件" type="text"
                                                                    required disabled
                                                                    [readonly]="CRDatas.body.bonita_case_id">
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                </table>

                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--需求說明-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>需求說明</mat-label>
                                                                <textarea matInput type="text"
                                                                    [(ngModel)]="CRDatas.body.demand_content"
                                                                    formControlName="demand_content"
                                                                    name="demand_content" ngDefaultControl required
                                                                    style="height: 100px;"
                                                                    [readonly]="CRDatas.body.bonita_case_id"></textarea>
                                                            </mat-form-field>
                                                        </td>
                                                        <td>
                                                            <!--適用製程說明-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>適用製程說明</mat-label>
                                                                <textarea matInput placeholder="請輸入適用製程說明" type="text"
                                                                    [(ngModel)]="CRDatas.body.suitable_content"
                                                                    formControlName="suitable_content"
                                                                    name="suitable_content" ngDefaultControl required
                                                                    style="height: 100px;"
                                                                    [readonly]="CRDatas.body.bonita_case_id"></textarea>
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                </table>


                                                <!--其他-->
                                                <mat-form-field appearance="outline" class="width100">
                                                    <mat-label>其他</mat-label>
                                                    <textarea matInput type="text"
                                                        [(ngModel)]="CRDatas.body.other_content"
                                                        formControlName="other_content" name="other_content"
                                                        ngDefaultControl required style="height: 50px;"
                                                        [readonly]="CRDatas.body.bonita_case_id"></textarea>
                                                </mat-form-field>



                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--客戶預算-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>預算</mat-label>
                                                                <input matInput type="text"
                                                                    [(ngModel)]="CRDatas.body.budget"
                                                                    formControlName="budget" name="budget"
                                                                    ngDefaultControl required
                                                                    [readonly]="CRDatas.body.bonita_case_id">
                                                            </mat-form-field>
                                                        </td>
                                                        <td>
                                                            <!--客戶預估時程-->
                                                            <mat-form-field class="example-form-field"
                                                                appearance="outline" class="width100">
                                                                <mat-label>客戶預估</mat-label>
                                                                <mat-date-range-input [formGroup]="campaignOne"
                                                                    [rangePicker]="campaignOnePicker" required
                                                                    [disabled]="CRDatas.body.bonita_case_id">
                                                                    <input matStartDate
                                                                        [(ngModel)]="CRDatas.body.date_for_estimated_start"
                                                                        placeholder="Start date"
                                                                        formControlName="start">
                                                                    <input matEndDate
                                                                        [(ngModel)]="CRDatas.body.date_for_estimated_end"
                                                                        placeholder="End date" formControlName="end">
                                                                </mat-date-range-input>
                                                                <mat-datepicker-toggle matSuffix
                                                                    [for]="campaignOnePicker">
                                                                </mat-datepicker-toggle>
                                                                <mat-date-range-picker #campaignOnePicker>
                                                                </mat-date-range-picker>
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                </table>





                                                <h3>結論</h3>

                                                <!--舊機型衍生/新機型-->
                                                <mat-radio-group aria-label="Select an option"
                                                    class="example-radio-group"
                                                    [(ngModel)]="CRDatas.body.machine_status_id"
                                                    formControlName="machine_status_id" name="machine_status_id"
                                                    ngDefaultControl [disabled]="CRDatas.body.bonita_case_id">
                                                    <mat-radio-button value="e3a5c393-bd97-4cb3-830d-6a59bb4fcd60">不承接此案
                                                    </mat-radio-button>

                                                    <mat-list-item>
                                                        <mat-radio-button value="b996906d-d38b-42ea-b3ea-002c2a6f41e4"
                                                            style="margin-right: 10px;">
                                                            舊機型衍生
                                                        </mat-radio-button>
                                                        <mat-form-field appearance="outline"
                                                            style="width:25%;margin-right: 10px;">
                                                            <mat-select [(ngModel)]="CRDatas.body.extend_type_id"
                                                                formControlName="extend_type_id" name="extend_type_id"
                                                                ngDefaultControl
                                                                [disabled]="CRDatas.body.bonita_case_id">
                                                                <mat-option class="option-30"
                                                                    *ngFor="let select of AllModel"
                                                                    [value]="select.name">
                                                                    {{select.name}}
                                                                </mat-option>
                                                            </mat-select>
                                                        </mat-form-field>
                                                        <mat-form-field appearance="outline" style="width:45%">
                                                            <textarea matInput cdkTextareaAutosize
                                                                #autosize="cdkTextareaAutosize" cdkAutosizeMinRows="1"
                                                                cdkAutosizeMaxRows="5" type="text"
                                                                [(ngModel)]="CRDatas.body.extend_rem"
                                                                formControlName="extend_rem" name="extend_rem"
                                                                ngDefaultControl
                                                                [readonly]="CRDatas.body.bonita_case_id"></textarea>
                                                        </mat-form-field>
                                                    </mat-list-item>

                                                    <mat-radio-button value="0707d4db-30fa-4053-85de-d8b837a3e22e">新機型
                                                    </mat-radio-button>
                                                </mat-radio-group>



                                                <table class="width100" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <!--技術可行性評估報告，預計送審時間-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>技術可行性評估報告，預計送審時間</mat-label>
                                                                <input matInput [matDatepicker]="repoerDatePicker"
                                                                    [(ngModel)]="CRDatas.body.date_for_devlop"
                                                                    formControlName="date_for_devlop"
                                                                    name="date_for_devlop" ngDefaultControl required
                                                                    [disabled]="CRDatas.body.bonita_case_id"
                                                                    [min]="CRDatas.body.date_for_recive">
                                                                <mat-datepicker-toggle matSuffix
                                                                    [for]="repoerDatePicker">
                                                                </mat-datepicker-toggle>
                                                                <mat-datepicker #repoerDatePicker></mat-datepicker>
                                                            </mat-form-field>
                                                        </td>
                                                        <td>
                                                            <!--未來三年預估數量-->
                                                            <mat-form-field appearance="outline" class="width100">
                                                                <mat-label>未來三年預估數量</mat-label>
                                                                <input matInput type="number" placeholder="請輸入未來三年預估數量"
                                                                    [(ngModel)]="CRDatas.body.est_quantity"
                                                                    formControlName="est_quantity" name="est_quantity"
                                                                    ngDefaultControl required
                                                                    [readonly]="CRDatas.body.bonita_case_id" min="0">
                                                            </mat-form-field>
                                                        </td>
                                                    </tr>
                                                </table>
                                                <!--不須提出技術可行性報告-->
                                                <section class="example-section">
                                                    <mat-list>
                                                        <mat-list-item>
                                                            <mat-checkbox [(ngModel)]="CRDatas.body.eva_report"
                                                                formControlName="eva_report" name="eva_report"
                                                                ngDefaultControl>不須提出技術可行性評估報告
                                                            </mat-checkbox>
                                                        </mat-list-item>
                                                    </mat-list>
                                                </section>

                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-5">
                            <div class="pt-0 pb-0 container" *ngIf="CRDatas">
                                <!--簽核-->
                                <div class="col">
                                    <h3>簽核流程</h3>
                                    <dl class="row">
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">發文單位:</h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 class="text-context">營運業務部</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">發文者:</h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 class="text-context">{{CRDatas.body.salesman_name}}
                                                {{CRDatas.body.create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">單位主管: </h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 *ngIf="department_interview[0]">{{department_interview[0].creater_name}}
                                                {{department_interview[0].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">副總: </h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 *ngIf="department_interview[1]">{{department_interview[1].creater_name}}
                                                {{department_interview[1].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">總經理:</h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 *ngIf="department_interview[2]">{{department_interview[2].creater_name}}
                                                {{department_interview[2].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <dt class="px-0 col-sm-2 ml-10">
                                            <h4 class="text-head text-right">PM: </h4>
                                        </dt>
                                        <dd class="col-sm-9">
                                            <h4 *ngIf="department_interview[3]">{{department_interview[3].creater_name}}
                                                {{department_interview[3].create_time | date:
                                                'yyyy/MM/dd hh:mm'}}</h4>
                                        </dd>
                                        <!-- <dt class="col-sm-2">
                                    <h4 class="text-head text-right">完工日期: </h4>
                                </dt>
                                <dd class="col">
                                    <h4 *ngIf="department_interview[4]">{{department_interview[4].create_time | date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </dd> -->

                                    </dl>
                                </div>


                                <!--會簽單位-->
                                <h3>會簽單位</h3>

                                <section class="example-section">
                                    <span class="example-list-section">
                                        <mat-list>
                                            <mat-list-item *ngFor="let item of CSdepartmentList;let i=index">
                                                <mat-checkbox [(ngModel)]="item.ckecked" [disabled]="CScheckbox"
                                                    (ngModelChange)="updateCSComplete(item.id,item.cs_id)"
                                                    class="col-sm-6">
                                                    {{item.name}}:
                                                </mat-checkbox>
                                                <div *ngIf="item.countersign_user">
                                                    <span *ngFor="let item of CSdepartmentList[i].countersign_user">
                                                        {{item.name}}
                                                    </span>
                                                </div>
                                            </mat-list-item>
                                        </mat-list>
                                    </span>
                                </section>

                                <!--結案??-->

                                <div *ngIf="bonita_task_id">
                                    <!-- 業務結案 -->

                                    <form [formGroup]="closeForm">
                                        <mat-radio-group aria-label="Select an option" class="example-radio-group"
                                            [(ngModel)]="CRDatas.body.result_status" formControlName="result_status"
                                            name="result_status" ngDefaultControl>
                                            <mat-list-item>
                                                <mat-radio-button value="pending">Pending:
                                                </mat-radio-button>
                                                <mat-form-field appearance="outline">
                                                    <mat-label>再議日期</mat-label>
                                                    <input matInput [matDatepicker]="resultDatePicker"
                                                        [(ngModel)]="CRDatas.body.date_for_result"
                                                        formControlName="date_for_result" name="date_for_result">
                                                    <mat-datepicker-toggle matSuffix [for]="resultDatePicker">
                                                    </mat-datepicker-toggle>
                                                    <mat-datepicker #resultDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </mat-list-item>

                                            <mat-list-item>
                                                <mat-radio-button value="拒絕">不擬執行正式專案，拒絕。
                                                </mat-radio-button>
                                            </mat-list-item>

                                            <mat-form-field appearance="outline" class="width100">
                                                <mat-label>原因說明</mat-label>
                                                <textarea matInput cdkTextareaAutosize #autosize="cdkTextareaAutosize"
                                                    cdkAutosizeMinRows="1" cdkAutosizeMaxRows="5" type="text"
                                                    [(ngModel)]="CRDatas.body.result_content"
                                                    formControlName="result_content" name="result_content"
                                                    ngDefaultControl></textarea>
                                            </mat-form-field>

                                            <mat-list-item>
                                                <mat-radio-button value="有機會發展">有發展機會，擬轉正式執行專案執行
                                                </mat-radio-button>
                                                <mat-form-field appearance="outline" class="width100">
                                                    <mat-label>正式專案代號</mat-label>
                                                    <mat-select [(ngModel)]="CRDatas.body.project_id"
                                                        formControlName="project_id" name="project_id" ngDefaultControl>
                                                        <mat-option class="option-30" *ngFor="let project of codeList"
                                                            [value]="project.id">
                                                            {{project.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </mat-list-item>

                                        </mat-radio-group>
                                    </form>

                                </div>


                                <div [hidden]="bonita_task_id">
                                    <div *ngIf="CRDatas.body.result_status">
                                        <!-- 結案後才顯示 -->
                                        <mat-radio-group aria-label="Select an option" class="example-radio-group"
                                            [(ngModel)]="CRDatas.body.result_status" [disabled]="true">
                                            <mat-list-item>

                                                <table class="example-full-width" cellspacing="0">
                                                    <tr>
                                                        <td>
                                                            <mat-radio-button value="pending">Pending
                                                            </mat-radio-button>
                                                        </td>
                                                        <td>
                                                            <!-- <h4 class="text-context">{{CRDatas.body.date_for_result| date:
                                                                'yyyy/MM/dd'}}</h4> -->

                                                            <span
                                                                *ngIf="CRDatas.body.date_for_result != '0001-01-01T00:00:00Z'">
                                                                {{CRDatas.body.date_for_result | date: 'yyyy/MM/dd'}}
                                                            </span>
                                                            <span
                                                                *ngIf="CRDatas.body.date_for_result == '0001-01-01T00:00:00Z'">

                                                            </span>
                                                        </td>
                                                    </tr>
                                                </table>

                                            </mat-list-item>



                                            <mat-list-item>
                                                <mat-radio-button value="拒絕">不擬執行正式專案，拒絕。
                                                </mat-radio-button>
                                            </mat-list-item>

                                            <mat-list-item>
                                                <h4>原因說明:{{CRDatas.body.result_content}}</h4>
                                            </mat-list-item>

                                            <mat-list-item>
                                                <mat-radio-button value="有機會發展">有發展機會，擬轉正式執行專案執行
                                                </mat-radio-button>


                                                <mat-form-field appearance="outline" class="width100">
                                                    <mat-label>正式專案代號</mat-label>
                                                    <mat-select [(ngModel)]="CRDatas.body.project_id" [disabled]="true">
                                                        <mat-option class="option-30" *ngFor="let project of codeList"
                                                            [value]="project.id">
                                                            {{project.name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>

                                            </mat-list-item>

                                        </mat-radio-group>



                                    </div>
                                </div>



                            </div>
                        </div>
                    </div>
                </div>



            </mat-tab>
            <!--tab:任務資料-->
            <mat-tab label="任務資料">

                <!-- <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>任務資料</h3>
                        </div>
                    </div>
                </div> -->

                <div class="container">
                </div>
                <!--btn:新建任務-->
                <!-- <div class="row">
                    <div class="form-group pt-3 pb-0 text-center">
                        <button mat-button class="btn-none mb-3" (click)="addTask(c_id,CRDatas.body.bonita_case_id)"
                            matTooltip="新建任務">
                            <mat-icon>add</mat-icon>
                            新建任務
                        </button>
                    </div>
                </div> -->


                <div class="container">
                    <!--顯示資料區域-->
                    <div class="row">
                        <div class="col">
                            <div class="pt-0 pb-2">
                                <!--p-treeTable-->
                                <p-treeTable [value]="files1" [columns]="cols" class="table">
                                    <!-- <ng-template pTemplate="caption">
                                        任務列表
                                    </ng-template> -->
                                    <ng-template pTemplate="colgroup" let-columns>
                                        <colgroup>
                                            <col *ngFor="let col of columns" [style.width]="col.width">
                                        </colgroup>
                                    </ng-template>
                                    <!-- <ng-template pTemplate="header" let-columns>
                                        <colgroup>
                                            <th *ngFor="let col of columns">
                                                {{col.header}}
                                            </th>
                                            <th>
                                                編輯
                                            </th>
                                        </colgroup>
                                    </ng-template> -->
                                    <ng-template pTemplate="header" let-columns>
                                        <!-- <colgroup>
                                            
                                        </colgroup> -->
                                        <tr>
                                            <th *ngFor="let col of columns">
                                                {{col.header}}
                                            </th>
                                            <th>
                                                <button mat-mini-fab color="basic" class="table-btn-none"
                                                    (click)="addTask(c_id,CRDatas.body.bonita_case_id)">
                                                    <mat-icon>add</mat-icon>
                                                </button>
                                            </th>
                                        </tr>
                                    </ng-template>
                                    <ng-template pTemplate="body" let-rowNode let-rowData="rowData"
                                        let-columns="columns">
                                        <tr>
                                            <td *ngFor="let col of columns; let i = index">
                                                <p-treeTableToggler [rowNode]="rowNode" *ngIf="i == 0">
                                                </p-treeTableToggler>
                                                {{rowData[col.field] }}
                                            </td>

                                            <!-- <td *ngFor="let col of columns; let i = index">
                                                <p-button icon="pi pi-pencil" styleClass="p-button-warning">{{col}}</p-button>
                                            </td> -->

                                            <td>
                                                <!-- <p-button icon="pi pi-pencil" styleClass="p-button-warning"
                                                    (click)="doPostEdit(c_id,rowData.t_id)"></p-button> -->
                                                <button mat-mini-fab color="basic" class="table-btn-none"
                                                    (click)="doPostEdit(c_id,rowData.t_id)">
                                                    <mat-icon>edit</mat-icon>
                                                </button>
                                            </td>
                                        </tr>
                                    </ng-template>
                                    <ng-template>
                                        <div style="text-align:left">
                                            <p-button icon="pi pi-refresh"></p-button>
                                        </div>
                                    </ng-template>
                                </p-treeTable>
                                <!--<div class="table-container">
                                    <div class="table">
                                        <table mat-table [dataSource]="dataSource_1" class="">
                                            
                                            <ng-container matColumnDef="code">
                                                <th mat-header-cell *matHeaderCellDef>任務編號</th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.code}}
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="t_name">
                                                <th mat-header-cell *matHeaderCellDef>任務名稱</th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.t_name}}
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="name">
                                                <th mat-header-cell *matHeaderCellDef>任務負責人名稱</th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.name}}
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="remark">
                                                <th mat-header-cell *matHeaderCellDef> 任務描述 </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.remark}}
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="date_for_estimated_start">
                                                <th mat-header-cell *matHeaderCellDef> 開始時間(工時) </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.date_for_estimated_start  | date: 'yyyy/MM/dd'}} </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="date_for_estimated_completion">
                                                <th mat-header-cell *matHeaderCellDef> 結束時間(工時) </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.date_for_estimated_completion  | date: 'yyyy/MM/dd'}} </td>
                                            </ng-container>

                                           
                                            <ng-container matColumnDef="date_for_actual_completion">
                                                <th mat-header-cell *matHeaderCellDef> 實際完成日 </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    {{element.date_for_actual_completion  | date: 'yyyy/MM/dd'}} </td>
                                            </ng-container>

                                          
                                            <ng-container matColumnDef="file">
                                                <th mat-header-cell *matHeaderCellDef> 附件負責 </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    <button mat-mini-fab color="basic"
                                                        class="table-btn-none" (click)="fileUpload()">
                                                        <mat-icon>attach_file</mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>

                                            <ng-container matColumnDef="landmark">
                                                <th mat-header-cell *matHeaderCellDef > 里程碑 </th>
                                                <td mat-cell *matCellDef="let element;let index = index">
                                                    
                                                    <mat-checkbox [(ngModel)]="element.landmark" [disabled]="true"></mat-checkbox>
                                                    <mat-checkbox [(ngModel)]="element.landmark"></mat-checkbox>
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="t_id">
                                                <th mat-header-cell *matHeaderCellDef class="text-center">
                                                    編輯 </th>
                                                <td mat-cell *matCellDef="let element;let index = index"
                                                    class="text-center">
                                                    <button mat-mini-fab color="basic"
                                                        class="table-btn-none"
                                                        (click)="doPostEdit(element.t_id)">
                                                        <mat-icon>edit</mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>
                                            
                                            <ng-container matColumnDef="action_detail">
                                                <th mat-header-cell *matHeaderCellDef style="width: 30px;"
                                                    class="text-center"> 檢視 </th>
                                                <td mat-cell *matCellDef="let element;let index = index"
                                                    class="text-center">
                                                    <button mat-mini-fab color="basic"
                                                        class="table-btn-none"
                                                        (click)="doPostDetail(element.name,element.t_id,p_id)">
                                                        <mat-icon>visibility</mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>
                                            <tr mat-header-row *matHeaderRowDef="displayedColumns_1"></tr>
                                            <tr mat-row *matRowDef="let row; columns: displayedColumns_1;">
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <mat-paginator #paginator [length]="tasktotalCount" [pageIndex]="0"
                                    [pageSize]="5" [pageSizeOptions]="[5, 10, 15]"
                                    [showFirstLastButtons]="true">
                                </mat-paginator>-->
                            </div>
                        </div>
                    </div>
                </div>



            </mat-tab>
            <!--近十筆-->
            <mat-tab label="近10筆">

                <!-- <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>近10筆</h3>
                        </div>
                    </div>
                </div> -->
                <!--內容顯示-->
                <div class="container">

                    <div class="row">
                        <div class="col-md-12">
                            <!--下拉選單:相關客戶-->
                            <mat-form-field appearance="outline">
                                <mat-label>相關客戶</mat-label>
                                <mat-select>
                                    <mat-option class="option-30"
                                        *ngFor="let select of ['Rita','Peggy','Ted','Brian','Louis','Ken']"
                                        [value]="select" title="{{select}}">
                                        {{select}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>

                            <!--下拉選單:相關機台-->
                            <mat-form-field appearance="outline">
                                <mat-label>相關機台</mat-label>
                                <mat-select>
                                    <mat-option class="option-30" *ngFor="let select of AllModel" [value]="select.id">
                                        {{select.name}}
                                    </mat-option>
                                </mat-select>
                            </mat-form-field>
                            <button mat-raised-button class="btn" matRipple [matRippleUnbounded]="false">搜尋</button>

                            <!--資料顯示區-->


                            <div class="container">
                                <!--顯示資料區域-->
                                <div class="row">
                                    <div class="col">
                                        <div class="pt-0 pb-2">
                                            <div class="table-container">
                                                <div class="table">
                                                    <table #recentlySort='matSort' matSort mat-table
                                                        [dataSource]="recentlydataSource" class="">
                                                        <!-- 任務名稱 -->
                                                        <ng-container matColumnDef="code">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header>名稱
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.code}}
                                                            </td>
                                                        </ng-container>
                                                        <!-- 開始時間 -->
                                                        <ng-container matColumnDef="date_for_estimated_start">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 開始
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.date_for_estimated_start | date:
                                                                'yyyy/MM/dd'}} </td>
                                                        </ng-container>
                                                        <!-- 開始時間 -->
                                                        <ng-container matColumnDef="date_for_estimated_end">
                                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 結束
                                                            </th>
                                                            <td mat-cell *matCellDef="let element">
                                                                {{element.date_for_estimated_end | date:
                                                                'yyyy/MM/dd'}} </td>
                                                        </ng-container>
                                                        <tr mat-header-row
                                                            *matHeaderRowDef="displayedColumns2; sticky: true"></tr>
                                                        <tr mat-row *matRowDef="let row; columns: displayedColumns2;">
                                                        </tr>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </mat-tab>
            <!--製令資訊-->
            <mat-tab label="製令資訊">

                <!-- <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>製令資訊</h3>
                        </div>
                    </div>
                </div> -->

            </mat-tab>
            <!--tab:會議紀錄-->
            <mat-tab label="會議紀錄">

                <!-- <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>會議紀錄</h3>
                        </div>
                    </div>
                </div> -->
                <!--btn:新建會議-->
                <div class="container">
                    <div class="row pb-0">
                        <div class="form-group pt-0 pb-0 text-center">
                            <button mat-button class="btn-none" matRipple [matRippleUnbounded]="false"
                                (click)="doPostMeetAdd(c_id)" matTooltip="新建會議">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                    </div>

                    <!--資料顯示區-->
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-container">
                                <div class="table">
                                    <table #meetSort='matSort' matSort mat-table [dataSource]="meetDataSource"
                                        class="mat-elevation-z8">

                                        <!--- Note that these columns can be defined in any order.
                                          The actual rendered columns are set as a property on the row definition" -->

                                        <!-- Position Column -->
                                        <ng-container matColumnDef="m_name">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 名稱 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.m_name}} </td>
                                        </ng-container>

                                        <!-- Position Column -->
                                        <ng-container matColumnDef="name">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 主席 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.name}} </td>
                                        </ng-container>

                                        <!-- Name Column -->
                                        <ng-container matColumnDef="time_for_start">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 開始 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.time_for_start}}
                                            </td>
                                        </ng-container>

                                        <!-- Weight Column -->
                                        <ng-container matColumnDef="time_for_end">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 結束 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.time_for_end}}
                                            </td>
                                        </ng-container>

                                        <!-- Symbol Column -->
                                        <ng-container matColumnDef="date_for_start">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 日期 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.date_for_start | date:
                                                'yyyy/MM/dd'}}
                                            </td>
                                        </ng-container>

                                        <ng-container matColumnDef="room">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 地點 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.room}} </td>
                                        </ng-container>

                                        <ng-container matColumnDef="action_edit">
                                            <th mat-header-cell *matHeaderCellDef> 編輯 </th>
                                            <td mat-cell *matCellDef="let element"
                                                (click)="doPostMeetEdit(element.m_id,c_id)">
                                                <button mat-button class="">
                                                    <mat-icon>edit</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>

                                        <!-- Weight Column -->
                                        <ng-container matColumnDef="action_detail">
                                            <th mat-header-cell *matHeaderCellDef> 檢視 </th>
                                            <td mat-cell *matCellDef="let element">
                                                <button mat-button class="" (click)="doPostMeet(element.m_id)">
                                                    <mat-icon>visibility</mat-icon>
                                                </button>
                                            </td>
                                        </ng-container>
                                        <tr mat-header-row *matHeaderRowDef="display_meet"></tr>
                                        <tr mat-row *matRowDef="let row; columns: display_meet;"></tr>
                                    </table>
                                    <mat-paginator #meetPaginator [length]="meettotalCount" [pageIndex]="0"
                                        [pageSize]="10" [pageSizeOptions]="[5, 10, 15]" [showFirstLastButtons]="true">
                                    </mat-paginator>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </mat-tab>
            <!--表單紀錄-->
            <mat-tab label="表單紀錄">

                <!-- <div class="container">
                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>表單紀錄</h3>
                        </div>
                    </div>
                </div> -->

                <!--資料顯示區-->
                <div class="container">
                    <div class="row">
                        <div class="col-md-12">
                            <div class="table-container">
                                <div class="table">
                                    <table #interviewSortSort='matSort' matSort mat-table
                                        [dataSource]="interviewDataSource" class="mat-elevation-z8">

                                        <ng-container matColumnDef="content">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 動作 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.actor}}{{element.content}}
                                            </td>
                                        </ng-container>

                                        <!-- remark Column -->
                                        <ng-container matColumnDef="remark">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 備註 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.remark}}
                                            </td>
                                        </ng-container>

                                        <!-- name Column -->
                                        <ng-container matColumnDef="creater_name">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 人員 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.creater_name}}
                                            </td>
                                        </ng-container>

                                        <!-- creatTime Column -->
                                        <ng-container matColumnDef="create_time">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header> 創建時間 </th>
                                            <td mat-cell *matCellDef="let element"> {{element.create_time | date:
                                                'yyyy/MM/dd hh:mm'}}
                                            </td>
                                        </ng-container>

                                        <tr mat-header-row *matHeaderRowDef="interviewcol"></tr>
                                        <tr mat-row *matRowDef="let row; columns: interviewcol;"></tr>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>


            </mat-tab>
            <!--tab:簽核流程-->
            <mat-tab label="簽核流程">

                <div class="container" *ngIf="CRDatas">


                    <div class="row pt-2">
                        <div class="col-md-12 text-left">
                            <h3 class="text-center">單據簽核</h3>

                            <dl class="row">
                                <dt class="px-0 col-sm-2 ml-10">
                                    <h4 class="text-head text-right">發文者:</h4>
                                </dt>
                                <dd class="col-sm-9">
                                    <h4 class="text-context">{{CRDatas.body.salesman_name}} {{CRDatas.body.create_time |
                                        date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </dd>
                                <dt class="px-0 col-sm-2 ml-10">
                                    <h4 class="text-head text-right">單位主管: </h4>
                                </dt>
                                <dd class="col-sm-9">
                                    <h4 *ngIf="department_interview[0]">{{department_interview[0].creater_name}}
                                        {{department_interview[0].create_time | date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </dd>
                                <dt class="px-0 col-sm-2 ml-10">
                                    <h4 class="text-head text-right">副總: </h4>
                                </dt>
                                <dd class="col-sm-9">
                                    <h4 *ngIf="department_interview[1]">{{department_interview[1].creater_name}}
                                        {{department_interview[1].create_time | date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </dd>
                                <dt class="px-0 col-sm-2 ml-10">
                                    <h4 class="text-head text-right">總經理:</h4>
                                </dt>
                                <dd class="col-sm-9">
                                    <h4 *ngIf="department_interview[2]">{{department_interview[2].creater_name}}
                                        {{department_interview[2].create_time | date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </dd>
                            </dl>

                        </div>
                    </div>

                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <h3>會簽</h3>
                            <!--會簽資料顯示區-->
                            <div class="table-container">
                                <div class="table">

                                    <table mat-table [dataSource]="countersignDataSource" class="mat-elevation-z8">

                                        <ng-container matColumnDef="status">
                                            <th mat-header-cell *matHeaderCellDef> 狀態 </th>
                                            <td mat-cell *matCellDef="let element">

                                                <span *ngIf="element.date_for_completion != '0001-01-01T00:00:00Z'">
                                                    <mat-icon class="icon-green">
                                                        check_circle_outline
                                                    </mat-icon>
                                                </span>

                                            </td>
                                        </ng-container>

                                        <ng-container [matColumnDef]="str.en" *ngFor="let str of countersignColumnObj">
                                            <th mat-header-cell *matHeaderCellDef> {{str.cn}}
                                            </th>
                                            <td mat-cell *matCellDef="let element"> {{element[str.en]}} </td>
                                        </ng-container>

                                        <ng-container matColumnDef="date_for_completion">
                                            <th mat-header-cell *matHeaderCellDef> 時間 </th>
                                            <td mat-cell *matCellDef="let element">
                                                <!-- {{element.date_for_completion| date:
                                                'yyyy/MM/dd hh:mm'}} -->
                                                <span *ngIf="element.date_for_completion != '0001-01-01T00:00:00Z'">
                                                    {{element.date_for_completion | date: 'yyyy/MM/dd hh:mm'}}
                                                </span>
                                                <span *ngIf="element.date_for_completion == '0001-01-01T00:00:00Z'">

                                                </span>
                                            </td>
                                        </ng-container>



                                        <tr mat-header-row *matHeaderRowDef="countersignColumn; sticky: true">
                                        </tr>
                                        <tr mat-row *matRowDef="let row; columns: countersignColumn;"></tr>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="row pt-2">
                        <div class="col-md-12 text-center">
                            <mat-list>
                                <mat-list-item>
                                    <h4 class="text-head text-right">結束: </h4>
                                    <h4 *ngIf="department_interview[4]">{{department_interview[4].create_time | date:
                                        'yyyy/MM/dd hh:mm'}}</h4>
                                </mat-list-item>
                            </mat-list>
                        </div>
                    </div>

                </div>

            </mat-tab>
        </mat-tab-group>


    </mat-card>
</div>

<!--功能按鈕區-->
<div class="container">
    <div class="row">
        <div class="col-md-12 text-center">
            <div class="form-group pt-3 pb-0">
                <mat-card class="card search-group">



                    <button mat-raised-button class="btn-normal" (click)="addappendixItem()">附件</button>
                    <!-- <button mat-raised-button class="btn-normal">重整</button> -->
                    <!-- <button mat-raised-button class="btn-normal">會議</button>
                    <button mat-raised-button class="btn-normal">聯絡</button> -->
                    <button mat-raised-button class="btn-normal" (click)="print()">申請單</button>
                    <button mat-raised-button class="btn-normal" *ngIf="CRDatas"
                        [hidden]="CRDatas.body.bonita_case_id || permission"
                        (click)="deleteCustomerRequest(c_id);">刪除</button>
                    <button mat-raised-button class="btn" *ngIf="CRDatas"
                        [hidden]="CRDatas.body.bonita_case_id || permission"
                        (click)="updateCustomerRequest('填寫中');">儲存</button>
                    <button mat-raised-button class="btn-green" *ngIf="CRDatas"
                        [hidden]="CRDatas.body.bonita_case_id || permission"
                        (click)="getCRBonitaUserList(c_id);">送審</button>
                    <button mat-raised-button class="btn-green" *ngIf="restart_task_id"
                        (click)="resubmitCase();">重新送審</button>
                    <button mat-raised-button *ngIf="bonita_task_id" class="btn-green"
                        (click)="submitCase()">結案</button>


                    <!-- <p-button label="附件" styleClass="mr-2 p-button-raised p-button-secondary"
                        (onClick)="addappendixItem()">
                    </p-button>
                    <p-button label="申請單" styleClass="mr-2 p-button-raised p-button-secondary" (onClick)="print()">
                    </p-button>
                    <p-button label="刪除" styleClass="mr-2 p-button-raised p-button-secondary"
                        (click)="deleteCustomerRequest(c_id)" [hidden]="CRDatas.body.bonita_case_id || permission">
                    </p-button>
                    <p-button label="儲存" styleClass="mr-2 p-button-raised" (click)="updateCustomerRequest('填寫中')"
                        [hidden]="CRDatas.body.bonita_case_id || permission">
                    </p-button>
                    <p-button label="送審" styleClass="mr-2 p-button-raised p-button-success"
                        (click)="getCRBonitaUserList(c_id)" [hidden]="CRDatas.body.bonita_case_id || permission">
                    </p-button>
                    <p-button label="重新送審" styleClass="mr-2 p-button-raised p-button-success" (click)="resubmitCase()"
                        *ngIf="restart_task_id">
                    </p-button>
                    <p-button label="結案" styleClass="mr-2 p-button-raised p-button-success" (click)="submitCase()"
                        *ngIf="bonita_task_id">
                    </p-button> -->

                </mat-card>
            </div>
        </div>
    </div>
</div>

<!--頁面所需使用Dialog-->
<ng-template #addDialog>
    <app-add-dialog title=""></app-add-dialog>
</ng-template>

<ng-template #fileUpdateDialog>
    <app-file-update-dialog title=""></app-file-update-dialog>
</ng-template>

<ng-template #userDialog>
    <app-user-dialog title=""></app-user-dialog>
</ng-template>

<ng-template #taskDialog>
    <app-task-dialog title=""></app-task-dialog>
</ng-template>

<ng-template #addMeetDialog>
    <app-add-meet-dialog title=""></app-add-meet-dialog>
</ng-template>

<ng-template #editMeetDialog>
    <app-edit-meet-dialog title=""></app-edit-meet-dialog>
</ng-template>