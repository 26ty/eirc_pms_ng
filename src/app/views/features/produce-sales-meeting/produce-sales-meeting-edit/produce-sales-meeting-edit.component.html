<div class="container">
    <!--標題-->
    <div class="row">
        <div class="col-md-12">
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="/main/dashboard" class="a-blue">首頁</a></li>
                    <li class="breadcrumb-item active"><a href="/main/projectinfo/produce-sales-meeting"
                            class="a-blue">專案產銷會議</a></li>
                    <li class="breadcrumb-item active"><a>專案產銷-修改</a></li>

                    <!-- <li class="breadcrumb-item"><a href="/main/dashboard">首頁</a></li>
                    <li class="breadcrumb-item active">PM待回報專案</li> -->
                </ol>
            </nav>
        </div>
    </div>
    <!--查詢區域2 未命名-->
    <form #elementsForm="ngForm">
        <div class="form-group-edit pt-3 pb-0">
            <div class="row">
                <div class="col-3">
                    <mat-card class="card search-group left-card text-center">
                        <div class="row mt-3" *ngIf="projectDatas">
                            <div class="col">
                                <h3 class="mb-0 label-Required">必填欄位</h3>

                                <mat-form-field appearance="outline">
                                    <mat-label>來源單號</mat-label>
                                    <input matInput readonly type="text" value={{customer_code}} ngDefaultControl>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>專案代號</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.code" name="code"
                                        ngDefaultControl required [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>機台總成品號</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.machine_finished_number"
                                        name="machine_finished_number" ngDefaultControl required
                                        [readonly]="isReadOnly">
                                </mat-form-field>

                                <!-- 未完成 -->
                                <mat-form-field appearance="outline">
                                    <mat-label>客戶</mat-label>
                                    <mat-select [disabled]="isReadOnly" [(ngModel)]="projectDatas.body.customer_id"
                                        name="customer_id" ngDefaultControl required>
                                        <mat-option *ngFor="let user of customerList" [value]="user.id">
                                            {{user.name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="people-form-field">
                                    <mat-label>專案負責人</mat-label>
                                    <mat-select [(ngModel)]="projectDatas.body.projectman_id" name="projectman_id"
                                        ngDefaultControl required [disabled]="isReadOnly">
                                        <mat-optgroup *ngFor="let group of accountgroup" [label]="group.dep_name">
                                            <mat-option *ngFor="let account of group.account"
                                                [value]="account.account_id">
                                                {{account.name}}
                                            </mat-option>
                                        </mat-optgroup>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="people-form-field">
                                    <mat-label>業務負責人</mat-label>
                                    <mat-select [(ngModel)]="projectDatas.body.salesman_id" name="salesman_id"
                                        ngDefaultControl required [disabled]="isReadOnly">
                                        <mat-optgroup *ngFor="let group of accountgroup" [label]="group.dep_name">
                                            <mat-option *ngFor="let account of group.account"
                                                [value]="account.account_id">
                                                {{account.name}}
                                            </mat-option>
                                        </mat-optgroup>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="outline" class="people-form-field">
                                    <mat-label>客服負責人</mat-label>
                                    <mat-select [(ngModel)]="projectDatas.body.serviceman_id" name="serviceman_id"
                                        ngDefaultControl required [disabled]="isReadOnly">
                                        <mat-optgroup *ngFor="let group of accountgroup" [label]="group.dep_name">
                                            <mat-option *ngFor="let account of group.account"
                                                [value]="account.account_id">
                                                {{account.name}}
                                            </mat-option>
                                        </mat-optgroup>
                                    </mat-select>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>專案起始日</mat-label>
                                    <input matInput [matDatepicker]="picker_done"
                                        [(ngModel)]="projectDatas.body.date_for_start" name="date_for_start"
                                        ngDefaultControl required [disabled]="isReadOnly">
                                    <mat-datepicker-toggle matSuffix [for]="picker_done">
                                    </mat-datepicker-toggle>
                                    <mat-datepicker #picker_done></mat-datepicker>
                                    <mat-error>
                                        必填
                                    </mat-error>
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>專案結束日</mat-label>
                                    <input matInput [matDatepicker]="picker"
                                        [(ngModel)]="projectDatas.body.date_for_end" name="date_for_end"
                                        ngDefaultControl required [disabled]="isReadOnly">
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker #picker></mat-datepicker>
                                    <mat-error>
                                        必填
                                    </mat-error>
                                </mat-form-field>
                                <!-- <div class="test">
                                    起始日：{{projectDatas.body.date_for_start| date: 'yyyy-MM-dd HH:mm'}}
                                    結束日：{{projectDatas.body.date_for_end| date: 'yyyy-MM-dd HH:mm'}}
                                </div>  -->
                                <!-- <mat-form-field appearance="outline">
                                    <mat-label>專案起始日</mat-label>
                                    <input matInput [matDatepicker]="picker" [(ngModel)]="projectDatas.body.date_for_start" name="date_for_start" ngDefaultControl>
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker #picker></mat-datepicker>
                                </mat-form-field>
                                <mat-form-field appearance="outline">
                                    <mat-label>專案結束日</mat-label>
                                    <input matInput [matDatepicker]="picker" [(ngModel)]="projectDatas.body.date_for_end" name="date_for_end" ngDefaultControl>
                                    <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                                    <mat-datepicker #picker></mat-datepicker>
                                </mat-form-field> -->

                                <mat-form-field appearance="outline">
                                    <mat-label>治具數量</mat-label>
                                    <input matInput type="number" min="0" [(ngModel)]="projectDatas.body.jig_quantity"
                                        name="jig_quantity" ngDefaultControl required [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>專案範本</mat-label>
                                    <mat-select matNativeControl required [(ngModel)]="projectDatas.body.is_template"
                                        name="is_template" [disabled]="isReadOnly">
                                        <mat-option value="false">否</mat-option>
                                        <mat-option value="true">是</mat-option>
                                    </mat-select>
                                </mat-form-field>

                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col" *ngIf="projectDatas">
                                <h3 class="mb-0">選填欄位</h3>

                                <mat-form-field appearance="outline">
                                    <mat-label>機台英文名稱</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.machine_english"
                                        name="machine_english" ngDefaultControl [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>機台數量</mat-label>
                                    <input matInput type="number" min="0"
                                        [(ngModel)]="projectDatas.body.machine_quantity" name="machine_quantity"
                                        ngDefaultControl [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>銘板</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.nameplate"
                                        name="nameplate" ngDefaultControl [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>外部訂單</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.external_order"
                                        name="external_order" ngDefaultControl [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>內部訂單</mat-label>
                                    <input matInput type="text" [(ngModel)]="projectDatas.body.internal_order"
                                        name="internal_order" ngDefaultControl [readonly]="isReadOnly">
                                </mat-form-field>

                                <mat-form-field appearance="outline">
                                    <mat-label>摘要說明</mat-label>
                                    <textarea matInput type="text" [(ngModel)]="projectDatas.body.summary_description"
                                        name="summary_description" ngDefaultControl [readonly]="isReadOnly">
                                    </textarea>
                                </mat-form-field>
                            </div>
                        </div>
                        <!-- <button mat-mini-fab color="basic" class="table-btn-none">
                            <mat-icon>edit</mat-icon>
                        </button> -->
                        <div class="row mt-3">
                            <div class="col text-center">
                                <button mat-mini-fab class="table-btn-none" (click)="addmeetingItem(p_id)"
                                    matTooltip="會議">
                                    <mat-icon>supervisor_account</mat-icon>
                                </button>
                                <button mat-mini-fab class="table-btn" (click)="addappendixItem()" matTooltip="附件">
                                    <mat-icon>attach_file</mat-icon>
                                </button>
                                <button mat-mini-fab class="table-btn" (click)="addscheduleItem()" matTooltip="排程">
                                    <mat-icon>timeline</mat-icon>
                                </button>
                                <button mat-mini-fab class="table-btn" (click)="sweetalert_delete()" matTooltip="刪除">
                                    <mat-icon>delete</mat-icon>
                                </button>
                            </div>
                        </div>
                        <div class="row text-center">
                            <div class="col text-center">
                                <!-- <button mat-button class="btn-delete" (click)="test()">刪除test</button> -->
                                <!-- <button mat-button class="btn-delete" (click)="sweetalert_delete()">刪除</button> -->
                                <button mat-button class="btn-danger" (click)="editOneProjectDatas('已中止', '中止')"
                                    *ngIf="status == '專案已啟動'">中止
                                </button>
                                <button mat-button class="btn" (click)="copytoadd(p_id)"
                                    *ngIf="status == '專案已啟動' && business == true">複製轉新增
                                </button>
                                <!-- <button mat-button class="btn-delete" (click)="test()">test</button> -->
                            </div>
                        </div>
                        <div class="row" *ngIf="status != '專案已啟動'">
                            <div class="col text-center">
                                <button mat-button class="btn-normal-none"
                                    (click)="editOneProjectDatas(status, '更新')">暫存</button>
                                <button mat-button class="btn" *ngIf="status != '已中止'"
                                    (click)="startProjectDatas('待專案啟動', '啟動')">啟動</button>
                                <!-- <button mat-button class="btn-green" *ngIf="status != '已中止'"
                                    (click)="editOneProjectDatas('待專案啟動', '啟動')">啟動專案</button> -->
                                <button mat-button class="btn" *ngIf="status == '已中止'"
                                    (click)="startProjectDatas('待專案啟動', '啟動')">再啟動</button>
                            </div>
                        </div>
                        <!-- <div class="row">
                            <div class="col text-center">
                                <button mat-button class="btn-normal-none" (click)="editurl()">離開</button>
                            </div>
                        </div> -->
                    </mat-card>
                </div>
                <div class="col-9">
                    <mat-card class="card search-group right-card">
                        <p-tabView *ngIf="projectDatas">
                            <p-tabPanel header="機台">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <table mat-table [dataSource]="dataSource_1"
                                            class="mat-elevation-z8 demo-table">
                                            <!-- taskname Column -->
                                            <ng-container matColumnDef="taskname">
                                                <th mat-header-cell class="table-taskname-header label-Required"
                                                    *matHeaderCellDef>
                                                    項目/參與人員
                                                </th>
                                                <td mat-cell class="table-taskname" *matCellDef="let element">
                                                    <button mat-button
                                                        (click)="AddTaskUsers(isReadOnly, element, element.date_for_estimated_start_1, element.date_for_estimated_completion_1, element.principal_1, element.file_1, element.remark_1)"><u
                                                            class='text-link'>{{element.taskname}}</u></button>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_start Column -->
                                            <ng-container matColumnDef="date_for_estimated_start_1">
                                                <th mat-header-cell
                                                    class="table-date_for_estimated_start label-Required"
                                                    *matHeaderCellDef>
                                                    預計起始日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_start"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" [min]="projectDatas.body.date_for_start"
                                                            name="date_for_estimated_start_1-{{index}}"
                                                            (ngModelChange)="changedate($event,'ELEMENT_DATA_1',index)"
                                                            [(ngModel)]="element.date_for_estimated_start_1">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_completion Column -->
                                            <ng-container matColumnDef="date_for_estimated_completion_1">
                                                <th mat-header-cell
                                                    class="table-date_for_estimated_completion label-Required"
                                                    *matHeaderCellDef>
                                                    預計完成日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_completion"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" name="date_for_estimated_completion_1-{{index}}"
                                                            [min]="element.date_for_estimated_start_1 || projectDatas.body.date_for_start"
                                                            [(ngModel)]="element.date_for_estimated_completion_1">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_actual_completion Column -->
                                            <ng-container matColumnDef="date_for_actual_completion_1">
                                                <th mat-header-cell class="table-date_for_actual_completion"
                                                    *matHeaderCellDef>
                                                    實際完成日
                                                </th>
                                                <td mat-cell class="table-date_for_actual_completion"
                                                    *matCellDef="let element">
                                                    <mat-form-field appearance="outline" style="width:95px">
                                                        <input matInput readonly
                                                            value={{element.date_for_actual_completion_1}}>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- principal Column -->
                                            <ng-container matColumnDef="principal_1">
                                                <th mat-header-cell class="table-principal label-Required"
                                                    *matHeaderCellDef>
                                                    負責人</th>
                                                <td mat-cell class="table-principal"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-select [disabled]="isReadOnly" type="text"
                                                            name="principal_1-{{index}}"
                                                            [(ngModel)]="element.principal_1" ngDefaultControl>
                                                            <mat-optgroup *ngFor="let group of element.grouplist"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup>
                                                            <!-- <mat-optgroup *ngFor="let group of accountgroup"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup> -->
                                                        </mat-select>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>



                                            <!-- file Column -->
                                            <ng-container matColumnDef="file_1">
                                                <th mat-header-cell class="table-appendix-principal label-Required"
                                                    *matHeaderCellDef>
                                                    外掛附件</th>
                                                <td mat-cell *matCellDef="let element; let index = index">
                                                    <mat-checkbox [disabled]="isReadOnly"
                                                        class="table-appendix-principal" name="file_1-{{index}}"
                                                        [(ngModel)]="element.file_1">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- remark Column -->
                                            <ng-container matColumnDef="remark_1">
                                                <th mat-header-cell class="table-remark" *matHeaderCellDef>
                                                    備註
                                                </th>
                                                <td mat-cell class="table-remark"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:200px">
                                                        <textarea matInput name="remark_1-{{index}}"
                                                            style="word-wrap:normal;white-space: pre"
                                                            [readonly]="isReadOnly"
                                                            [(ngModel)]="element.remark_1"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                            <tr mat-row [class.demo-row-is-clicked]="clickedRows.has(row)"
                                                *matRowDef="let row; columns: displayedColumns;"></tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="治具">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <table mat-table [dataSource]="dataSource_2"
                                            class="mat-elevation-z8 demo-table">

                                            <!-- taskname Column -->
                                            <ng-container matColumnDef="taskname">
                                                <th mat-header-cell class="table-taskname-header" *matHeaderCellDef>
                                                    項目
                                                </th>
                                                <td mat-cell class="table-taskname" *matCellDef="let element">
                                                    {{element.taskname}}
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_start Column -->
                                            <ng-container matColumnDef="date_for_estimated_start_2">
                                                <th mat-header-cell class="table-date_for_estimated_start"
                                                    *matHeaderCellDef>
                                                    預計起始日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_start"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" [min]="projectDatas.body.date_for_start"
                                                            name="date_for_estimated_start_2-{{index}}"
                                                            (ngModelChange)="changedate($event,'ELEMENT_DATA_2',index)"
                                                            [(ngModel)]="element.date_for_estimated_start_2">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_completion Column -->
                                            <ng-container matColumnDef="date_for_estimated_completion_2">
                                                <th mat-header-cell class="table-date_for_estimated_completion"
                                                    *matHeaderCellDef>
                                                    預計完成日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_completion"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" name="date_for_estimated_completion_2-{{index}}"
                                                            [min]="element.date_for_estimated_start_2 || projectDatas.body.date_for_start"
                                                            [(ngModel)]="element.date_for_estimated_completion_2">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_actual_completion Column -->
                                            <ng-container matColumnDef="date_for_actual_completion_2">
                                                <th mat-header-cell class="table-date_for_actual_completion"
                                                    *matHeaderCellDef>
                                                    實際完成日
                                                </th>
                                                <td mat-cell class="table-date_for_actual_completion"
                                                    *matCellDef="let element">
                                                    <mat-form-field appearance="outline" style="width:95px">
                                                        <input [disabled]="isReadOnly" matInput disabled
                                                            value={{element.date_for_actual_completion_2}}>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- principal Column -->
                                            <ng-container matColumnDef="principal_2">
                                                <th mat-header-cell class="table-principal" *matHeaderCellDef>
                                                    負責人</th>
                                                <td mat-cell class="table-principal"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-select [disabled]="isReadOnly" type="text"
                                                            name="principal_2-{{index}}"
                                                            [(ngModel)]="element.principal_2" ngDefaultControl>
                                                            <mat-optgroup *ngFor="let group of element.grouplist"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- file Column -->
                                            <ng-container matColumnDef="file_2">
                                                <th mat-header-cell class="table-appendix-principal" *matHeaderCellDef>
                                                    外掛附件</th>
                                                <td mat-cell *matCellDef="let element; let index = index">
                                                    <mat-checkbox [disabled]="isReadOnly"
                                                        class="table-appendix-principal" name="file_2-{{index}}"
                                                        [(ngModel)]="element.file_2">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- remark Column -->
                                            <ng-container matColumnDef="remark_2">
                                                <th mat-header-cell class="table-remark" *matHeaderCellDef>
                                                    備註
                                                </th>
                                                <td mat-cell class="table-remark"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:200px">
                                                        <textarea [readonly]="isReadOnly" matInput
                                                            name="remark_2-{{index}}"
                                                            style="word-wrap:normal;white-space: pre"
                                                            [(ngModel)]="element.remark_2"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumns_2"></tr>
                                            <tr mat-row [class.demo-row-is-clicked]="clickedRows_2.has(row)"
                                                *matRowDef="let row; columns: displayedColumns_2;"></tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="書面資料">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <table mat-table [dataSource]="dataSource_3"
                                            class="mat-elevation-z8 demo-table">

                                            <!-- taskname Column -->
                                            <ng-container matColumnDef="taskname">
                                                <th mat-header-cell class="table-taskname-header" *matHeaderCellDef>
                                                    項目/參與人員
                                                </th>
                                                <td mat-cell class="table-taskname" *matCellDef="let element">
                                                    <button mat-button
                                                        (click)="AddTaskUsers(isReadOnly, element, element.date_for_estimated_start_3, element.date_for_estimated_completion_3, element.principal_3, element.file_3, element.remark_3)"><u
                                                            class='text-link'>{{element.taskname}}</u></button>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_start Column -->
                                            <ng-container matColumnDef="date_for_estimated_start_3">
                                                <th mat-header-cell class="table-date_for_estimated_start"
                                                    *matHeaderCellDef>
                                                    預計起始日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_start"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" [min]="projectDatas.body.date_for_start"
                                                            name="date_for_estimated_start_3-{{index}}"
                                                            (ngModelChange)="changedate($event,'ELEMENT_DATA_3',index)"
                                                            [(ngModel)]="element.date_for_estimated_start_3">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_completion Column -->
                                            <ng-container matColumnDef="date_for_estimated_completion_3">
                                                <th mat-header-cell class="table-date_for_estimated_completion"
                                                    *matHeaderCellDef>
                                                    預計完成日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_completion"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" name="date_for_estimated_completion_3-{{index}}"
                                                            [min]="element.date_for_estimated_start_3 || projectDatas.body.date_for_start"
                                                            [(ngModel)]="element.date_for_estimated_completion_3">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_actual_completion Column -->
                                            <ng-container matColumnDef="date_for_actual_completion_3">
                                                <th mat-header-cell class="table-date_for_actual_completion"
                                                    *matHeaderCellDef>
                                                    實際完成日
                                                </th>
                                                <td mat-cell class="table-date_for_actual_completion"
                                                    *matCellDef="let element">
                                                    <mat-form-field appearance="outline" style="width:95px">
                                                        <input [disabled]="isReadOnly" matInput disabled
                                                            value={{element.date_for_actual_completion_3}}>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- principal Column -->
                                            <ng-container matColumnDef="principal_3">
                                                <th mat-header-cell class="table-principal" *matHeaderCellDef>
                                                    負責人</th>
                                                <td mat-cell class="table-principal"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-select [disabled]="isReadOnly" type="text"
                                                            name="principal_3-{{index}}"
                                                            [(ngModel)]="element.principal_3" ngDefaultControl>
                                                            <mat-optgroup *ngFor="let group of element.grouplist"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- file Column -->
                                            <ng-container matColumnDef="file_3">
                                                <th mat-header-cell class="table-appendix-principal" *matHeaderCellDef>
                                                    外掛附件</th>
                                                <td mat-cell *matCellDef="let element; let index = index">
                                                    <mat-checkbox [disabled]="isReadOnly"
                                                        class="table-appendix-principal" name="file_3-{{index}}"
                                                        [(ngModel)]="element.file_3">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- remark Column -->
                                            <ng-container matColumnDef="remark_3">
                                                <th mat-header-cell class="table-remark" *matHeaderCellDef>
                                                    備註
                                                </th>
                                                <td mat-cell class="table-remark"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:200px">
                                                        <textarea [readonly]="isReadOnly" matInput
                                                            name="remark_3-{{index}}"
                                                            style="word-wrap:normal;white-space: pre"
                                                            [(ngModel)]="element.remark_3"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumns_3"></tr>
                                            <tr mat-row [class.demo-row-is-clicked]="clickedRows_3.has(row)"
                                                *matRowDef="let row; columns: displayedColumns_3;"></tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="試機需求部品">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <table mat-table [dataSource]="dataSource_4"
                                            class="mat-elevation-z8 demo-table">

                                            <!-- taskname Column -->
                                            <ng-container matColumnDef="taskname">
                                                <th mat-header-cell class="table-taskname-header_4" *matHeaderCellDef>
                                                    項目
                                                </th>
                                                <td mat-cell class="table-taskname_4" *matCellDef="let element">
                                                    {{element.taskname}}
                                                </td>
                                            </ng-container>

                                            <!-- quantity Column -->
                                            <ng-container matColumnDef="quantity">
                                                <th mat-header-cell class="table-quantity" *matHeaderCellDef>
                                                    規格/數量</th>
                                                <td mat-cell class="table-quantity"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:70px">
                                                        <input [readonly]="isReadOnly" matInput
                                                            class="table-quantity-input" type="text"
                                                            name="quantity-{{index}}" [(ngModel)]="element.quantity">
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_start Column -->
                                            <ng-container matColumnDef="date_for_estimated_start_4">
                                                <th mat-header-cell class="table-date_for_estimated_start"
                                                    *matHeaderCellDef>
                                                    預計起始日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_start"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" [min]="projectDatas.body.date_for_start"
                                                            name="date_for_estimated_start_4-{{index}}"
                                                            (ngModelChange)="changedate($event,'ELEMENT_DATA_4',index)"
                                                            [(ngModel)]="element.date_for_estimated_start_4">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_completion Column -->
                                            <ng-container matColumnDef="date_for_estimated_completion_4">
                                                <th mat-header-cell class="table-date_for_estimated_completion"
                                                    *matHeaderCellDef>
                                                    預計完成日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_completion"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" name="date_for_estimated_completion_4-{{index}}"
                                                            [min]="element.date_for_estimated_start_4 || projectDatas.body.date_for_start"
                                                            [(ngModel)]="element.date_for_estimated_completion_4">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_actual_completion Column -->
                                            <ng-container matColumnDef="date_for_actual_completion_4">
                                                <th mat-header-cell class="table-date_for_actual_completion"
                                                    *matHeaderCellDef>
                                                    實際完成日
                                                </th>
                                                <td mat-cell class="table-date_for_actual_completion"
                                                    *matCellDef="let element">
                                                    <mat-form-field appearance="outline" style="width:95px">
                                                        <input matInput disabled
                                                            value={{element.date_for_actual_completion_4}}>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- principal Column -->
                                            <ng-container matColumnDef="principal_4">
                                                <th mat-header-cell class="table-principal" *matHeaderCellDef>
                                                    負責人</th>
                                                <td mat-cell class="table-principal"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-select [disabled]="isReadOnly" type="text"
                                                            name="principal_4-{{index}}"
                                                            [(ngModel)]="element.principal_4" ngDefaultControl>
                                                            <mat-optgroup *ngFor="let group of element.grouplist"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- file Column -->
                                            <ng-container matColumnDef="file_4">
                                                <th mat-header-cell class="table-appendix-principal" *matHeaderCellDef>
                                                    外掛附件</th>
                                                <td mat-cell *matCellDef="let element; let index = index">
                                                    <mat-checkbox [disabled]="isReadOnly"
                                                        class="table-appendix-principal" name="file_4-{{index}}"
                                                        [(ngModel)]="element.file_4">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- remark Column -->
                                            <ng-container matColumnDef="remark_4">
                                                <th mat-header-cell class="table-remark" *matHeaderCellDef>
                                                    備註
                                                </th>
                                                <td mat-cell class="table-remark"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:200px">
                                                        <textarea [readonly]="isReadOnly" matInput
                                                            name="remark_4-{{index}}"
                                                            style="word-wrap:normal;white-space: pre"
                                                            [(ngModel)]="element.remark_4"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumns_4"></tr>
                                            <tr mat-row [class.demo-row-is-clicked]="clickedRows_4.has(row)"
                                                *matRowDef="let row; columns: displayedColumns_4;"></tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="其他">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <table mat-table [dataSource]="dataSource_5"
                                            class="mat-elevation-z8 demo-table">

                                            <!-- taskname Column -->
                                            <ng-container matColumnDef="taskname">
                                                <th mat-header-cell class="table-taskname-header" *matHeaderCellDef>
                                                    項目
                                                </th>
                                                <td mat-cell class="table-taskname" *matCellDef="let element">
                                                    {{element.taskname}}
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_start Column -->
                                            <ng-container matColumnDef="date_for_estimated_start_5">
                                                <th mat-header-cell class="table-date_for_estimated_start"
                                                    *matHeaderCellDef>
                                                    預計起始日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_start"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" [min]="projectDatas.body.date_for_start"
                                                            name="date_for_estimated_start_5-{{index}}"
                                                            (ngModelChange)="changedate($event,'ELEMENT_DATA_5',index)"
                                                            [(ngModel)]="element.date_for_estimated_start_5">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_estimated_completion Column -->
                                            <ng-container matColumnDef="date_for_estimated_completion_5">
                                                <th mat-header-cell class="table-date_for_estimated_completion"
                                                    *matHeaderCellDef>
                                                    預計完成日
                                                </th>
                                                <td mat-cell class="table-date_for_estimated_completion"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-label></mat-label>
                                                        <input [disabled]="isReadOnly" matInput [matDatepicker]="picker"
                                                            type="text" name="date_for_estimated_completion_5-{{index}}"
                                                            [min]="element.date_for_estimated_start_5 || projectDatas.body.date_for_start"
                                                            [(ngModel)]="element.date_for_estimated_completion_5">
                                                        <mat-datepicker-toggle matSuffix [for]="picker">
                                                        </mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- date_for_actual_completion Column -->
                                            <ng-container matColumnDef="date_for_actual_completion_5">
                                                <th mat-header-cell class="table-date_for_actual_completion"
                                                    *matHeaderCellDef>
                                                    實際完成日
                                                </th>
                                                <td mat-cell class="table-date_for_actual_completion"
                                                    *matCellDef="let element">
                                                    <mat-form-field appearance="outline" style="width:95px">
                                                        <input [disabled]="isReadOnly" matInput disabled
                                                            value={{element.date_for_actual_completion_5}}>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- principal Column -->
                                            <ng-container matColumnDef="principal_5">
                                                <th mat-header-cell class="table-principal" *matHeaderCellDef>
                                                    負責人</th>
                                                <td mat-cell class="table-principal"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:100px">
                                                        <mat-select [disabled]="isReadOnly" type="text"
                                                            name="principal_5-{{index}}"
                                                            [(ngModel)]="element.principal_5" ngDefaultControl>
                                                            <mat-optgroup *ngFor="let group of element.grouplist"
                                                                [label]="group.dep_name">
                                                                <mat-option *ngFor="let account of group.account"
                                                                    [value]="account.account_id">
                                                                    {{account.name}}
                                                                </mat-option>
                                                            </mat-optgroup>
                                                        </mat-select>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <!-- file Column -->
                                            <ng-container matColumnDef="file_5">
                                                <th mat-header-cell class="table-appendix-principal" *matHeaderCellDef>
                                                    外掛附件</th>
                                                <td mat-cell *matCellDef="let element; let index = index">
                                                    <mat-checkbox [disabled]="isReadOnly"
                                                        class="table-appendix-principal" name="file_5-{{index}}"
                                                        [(ngModel)]="element.file_5">
                                                    </mat-checkbox>
                                                </td>
                                            </ng-container>

                                            <!-- remark Column -->
                                            <ng-container matColumnDef="remark_5">
                                                <th mat-header-cell class="table-remark" *matHeaderCellDef>
                                                    備註
                                                </th>
                                                <td mat-cell class="table-remark"
                                                    *matCellDef="let element; let index = index">
                                                    <mat-form-field appearance="outline" style="width:200px">
                                                        <textarea [readonly]="isReadOnly" matInput
                                                            name="remark_5-{{index}}"
                                                            style="word-wrap:normal;white-space: pre"
                                                            [(ngModel)]="element.remark_5"></textarea>
                                                    </mat-form-field>
                                                </td>
                                            </ng-container>

                                            <tr mat-header-row *matHeaderRowDef="displayedColumns_5"></tr>
                                            <tr mat-row [class.demo-row-is-clicked]="clickedRows_5.has(row)"
                                                *matRowDef="let row; columns: displayedColumns_5;"></tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="組合機次階">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <!-- mc_code Column -->
                                        <mat-form-field appearance="outline" style="width:150px">
                                            <mat-label>專案代號</mat-label>
                                            <input [readonly]="isReadOnly" matInput type="text" [(ngModel)]="mc_code"
                                                name="mc_code" ngDefaultControl>
                                        </mat-form-field>
                                        <!-- mc_number Column -->
                                        <mat-form-field appearance="outline" style="width:100px">
                                            <mat-label>數量</mat-label>
                                            <input [readonly]="isReadOnly" matInput type="text" [(ngModel)]="mc_number"
                                                name="mc_number" ngDefaultControl>
                                        </mat-form-field>
                                        <!-- mc_finished Column -->
                                        <mat-form-field appearance="outline" style="width:150px">
                                            <mat-label>總成</mat-label>
                                            <input [readonly]="isReadOnly" matInput type="text"
                                                [(ngModel)]="mc_finished" name="mc_finished" ngDefaultControl>
                                        </mat-form-field>
                                        <!-- last_mc Column -->
                                        <mat-form-field appearance="outline" *ngIf="mc_status == 'add'"
                                            style="width:200px">
                                            <mat-label>前次專案</mat-label>
                                            <mat-select [disabled]="isReadOnly" [(ngModel)]="last_mc" name="last_mc"
                                                ngDefaultControl>
                                                <mat-option *ngFor="let mcData of mcDatas" [value]="mcData.mc_id">
                                                    {{mcData.mc_code}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        <!-- last_mc Column -->
                                        <mat-form-field appearance="outline" *ngIf="mc_status == 'edit'">
                                            <mat-label>前次專案</mat-label>
                                            <mat-select [disabled]="isReadOnly" [(ngModel)]="last_mc" name="last_mc"
                                                ngDefaultControl>
                                                <mat-option *ngFor="let editData of editmclist"
                                                    [value]="editData.mc_id">
                                                    {{editData.mc_code}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        <button mat-button class="btn-normal-none" (click)="uploadMachineDatas()"
                                            *ngIf="mc_status == 'add'">儲存</button>
                                        <button mat-button class="btn-normal-none" (click)="editMachineDatas()"
                                            *ngIf="mc_status == 'edit'">儲存</button>
                                        <button mat-button class="btn-normal" (click)="CancelDatas()">取消</button>
                                        <table mat-table [dataSource]="machinecombinedSource">
                                            <!-- mc_code -->
                                            <ng-container matColumnDef="mc_code">
                                                <th mat-header-cell *matHeaderCellDef>專案代號</th>
                                                <td mat-cell *matCellDef="let element">
                                                    {{element.mc_code}}
                                                </td>
                                            </ng-container>
                                            <!-- mc_number -->
                                            <ng-container matColumnDef="mc_number">
                                                <th mat-header-cell *matHeaderCellDef>數量</th>
                                                <td mat-cell *matCellDef="let element">
                                                    {{element.mc_number}}
                                                </td>
                                            </ng-container>
                                            <!-- mc_finished -->
                                            <ng-container matColumnDef="mc_finished">
                                                <th mat-header-cell *matHeaderCellDef>總成</th>
                                                <td mat-cell *matCellDef="let element">
                                                    {{element.mc_finished}}
                                                </td>
                                            </ng-container>
                                            <!-- last_mc_code -->
                                            <ng-container matColumnDef="last_mc_code">
                                                <th mat-header-cell *matHeaderCellDef>前一任務</th>
                                                <td mat-cell *matCellDef="let element">
                                                    {{element.last_mc_code}}
                                                </td>
                                            </ng-container>
                                            <!--action_edit-->
                                            <ng-container matColumnDef="action_edit">
                                                <th mat-header-cell *matHeaderCellDef class="text-center">
                                                    編輯 </th>
                                                <td mat-cell *matCellDef="let element;let index = index"
                                                    class="text-center">
                                                    <button mat-mini-fab color="basic" class="table-btn-none"
                                                        (click)="getOneMachineDatas(element.mc_id)">
                                                        <mat-icon>edit</mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>
                                            <!-- delete -->
                                            <ng-container matColumnDef="delete">
                                                <th mat-header-cell *matHeaderCellDef class="text-center">
                                                    刪除 </th>
                                                <td mat-cell *matCellDef="let element;let index = index"
                                                    class="text-center">
                                                    <button mat-mini-fab color="basic" class="table-btn-none"
                                                        (click)="deleteOneMachineDatas(element.mc_id)">
                                                        <mat-icon>delete</mat-icon>
                                                    </button>
                                                </td>
                                            </ng-container>
                                            <tr mat-header-row *matHeaderRowDef="machinecombinedColumns">
                                            </tr>
                                            <tr mat-row *matRowDef="let row; columns: machinecombinedColumns;">
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="外掛部品">
                                <!-- <div class="row">
                                    <div class="col">
                                        <mat-form-field appearance="outline" style="width:300px">
                                            <mat-label></mat-label>
                                            <textarea [readonly]="isReadOnly" matInput [(ngModel)]="content"
                                                name="content" ngDefaultControl></textarea>
                                        </mat-form-field>
                                        <button mat-button class="btn-none" (click)="uploadPlugInDatas()">儲存</button>
                                        <button mat-button class="btn-normal" (click)="CancelDatas()">清除</button>
                                    </div>
                                </div> -->
                                <!-- <div class="row">
                                    <div class="col">
                                        <div class="table-container">
                                            <div class="table text-left">
                                                <table mat-table [dataSource]="pluginSource">
                                                    
                                                    <ng-container matColumnDef="content">
                                                        <th mat-header-cell *matHeaderCellDef>需求內容</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.content}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="delete">
                                                        <th mat-header-cell *matHeaderCellDef class="text-center">
                                                            刪除 </th>
                                                        <td mat-cell *matCellDef="let element;let index = index"
                                                            class="text-center">
                                                            <button mat-mini-fab color="basic" class="table-btn-none"
                                                                (click)="deletePlugInDatas(element.pi_id)">
                                                                <mat-icon>delete</mat-icon>
                                                            </button>
                                                        </td>
                                                    </ng-container>
                                                    <tr mat-header-row *matHeaderRowDef="pluginColumns">
                                                    </tr>
                                                    <tr mat-row *matRowDef="let row; columns: pluginColumns;">
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div> -->
                                <div class="row" style="margin-left:2px">
                                    <div class="col">
                                        <h3>檔案總覽</h3>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="col">
                                        <div class="table-container">
                                            <div class="table">
                                                <table mat-table [dataSource]="AllfilesDataSource"
                                                    class="mat-elevation-z8">

                                                    <!--- Note that these columns can be defined in any order.
                                                          The actual rendered columns are set as a property on the row definition" -->

                                                    <!-- name Column -->
                                                    <ng-container matColumnDef="file_name">
                                                        <th mat-header-cell *matHeaderCellDef> 檔名 </th>
                                                        <td mat-cell *matCellDef="let element">
                                                            <button mat-button
                                                                (click)="fileDownload(element.download_url)"
                                                                matTooltip="點擊下載">
                                                                {{element.file_name}}.{{element.file_extension}}
                                                            </button>
                                                        </td>
                                                    </ng-container>

                                                    <!-- path Column -->
                                                    <ng-container matColumnDef="file_extension">
                                                        <th mat-header-cell *matHeaderCellDef class="display-none"> 副檔
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="display-none">
                                                            {{element.file_extension}} </td>
                                                    </ng-container>

                                                    <!-- path Column -->
                                                    <ng-container matColumnDef="creater_name">
                                                        <th mat-header-cell *matHeaderCellDef> 上傳者 </th>
                                                        <td mat-cell *matCellDef="let element"> {{element.creater_name}}
                                                        </td>
                                                    </ng-container>

                                                    <!-- creatTime Column -->
                                                    <ng-container matColumnDef="create_time">
                                                        <th mat-header-cell *matHeaderCellDef> 時間 </th>
                                                        <td mat-cell *matCellDef="let element"> {{element.create_time |
                                                            date: 'yyyy/MM/dd'}}
                                                        </td>
                                                    </ng-container>

                                                    <!-- action Column -->
                                                    <!-- <ng-container matColumnDef="action_delete">
                                                        <th mat-header-cell *matHeaderCellDef class="text-center">
                                                        </th>
                                                        <td mat-cell *matCellDef="let element" class="text-center">
                                                            <button mat-button class=""
                                                                (click)="deleteFilesRequest(element.f_id)">
                                                                <mat-icon>delete</mat-icon>
                                                            </button>
                                                        </td>
                                                    </ng-container> -->

                                                    <tr mat-header-row *matHeaderRowDef="Allfilescol"></tr>
                                                    <tr mat-row *matRowDef="let row; columns: Allfilescol;"></tr>
                                                </table>
                                                <mat-paginator #paginatorAllFile [length]="AllfilesTotal"
                                                    [pageIndex]="0" [pageSize]="5" [pageSizeOptions]="[5, 10, 15]"
                                                    [showFirstLastButtons]="true">
                                                </mat-paginator>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="相關紀錄">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <div class="row pt-3" style="margin-bottom: -15px;">
                                            <div class="col-md-5">
                                                <mat-list>
                                                    <mat-list-item class="signoff_process_content">
                                                        <h4>建檔者：</h4>
                                                        <h4 class="text-context" class="name" style="color:#3f51b5;">
                                                            {{creater}}</h4>
                                                    </mat-list-item>
                                                </mat-list>
                                            </div>
                                            <div class="col-md-7">
                                                <mat-list>
                                                    <mat-list-item class="signoff_process_content">
                                                        <h4>建檔日期：</h4>
                                                        <h4 class="text-context" class="name" style="color:#3f51b5;">
                                                            {{createtime | date: 'yyyy/MM/dd hh:mm'}}</h4>
                                                    </mat-list-item>
                                                </mat-list>
                                            </div>
                                        </div>
                                        <div class="row pt-3">
                                            <div class="col">
                                                <div class="row">
                                                    <div class="col ml-2">
                                                        <mat-list>
                                                            <mat-list-item>
                                                                <h4>
                                                                    異動紀錄:
                                                                </h4>
                                                            </mat-list-item>
                                                        </mat-list>

                                                    </div>
                                                </div>
                                                <div class="row">
                                                    <div class="col">
                                                        <table mat-table [dataSource]="transactionSource">
                                                            <!-- creater_name -->
                                                            <ng-container matColumnDef="creater_name">
                                                                <th mat-header-cell *matHeaderCellDef>異動者</th>
                                                                <td mat-cell *matCellDef="let element">
                                                                    {{element.creater_name}}
                                                                </td>
                                                            </ng-container>
                                                            <!-- create_time -->
                                                            <ng-container matColumnDef="create_time">
                                                                <th mat-header-cell *matHeaderCellDef>時間</th>
                                                                <td mat-cell *matCellDef="let element">
                                                                    {{element.create_time | date: 'yyyy/MM/dd hh:mm'}}
                                                                </td>
                                                            </ng-container>
                                                            <!-- actor -->
                                                            <ng-container matColumnDef="actor">
                                                                <th mat-header-cell *matHeaderCellDef>狀態</th>
                                                                <td mat-cell *matCellDef="let element">
                                                                    {{element.actor}}
                                                                </td>
                                                            </ng-container>
                                                            <!-- content -->
                                                            <ng-container matColumnDef="content">
                                                                <th mat-header-cell *matHeaderCellDef>內容</th>
                                                                <td mat-cell *matCellDef="let element">
                                                                    {{element.content}}
                                                                </td>
                                                            </ng-container>
                                                            <tr mat-header-row *matHeaderRowDef="transactionColumns">
                                                            </tr>
                                                            <tr mat-row
                                                                *matRowDef="let row; columns: transactionColumns;">
                                                            </tr>
                                                        </table>
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p-tabPanel>

                            <!--測試跑流-->
                            <!-- <p-tabPanel header="軟體(測試)">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <div class="row">
                                            <div class="col">
                                                
                                                <mat-form-field appearance="outline">
                                                    <mat-label>軟體名稱</mat-label>
                                                    <input [readonly]="isReadOnly" matInput type="text"
                                                        [(ngModel)]="as_name" name="as_name" ngDefaultControl>
                                                </mat-form-field>
                                                
                                                <mat-form-field appearance="outline">
                                                    <mat-label>軟體序號</mat-label>
                                                    <input [readonly]="isReadOnly" matInput type="text"
                                                        [(ngModel)]="software_number" name="software_number"
                                                        ngDefaultControl>
                                                </mat-form-field>
                                                
                                                <mat-form-field appearance="outline">
                                                    <mat-label>總成</mat-label>
                                                    <input [readonly]="isReadOnly" matInput type="text"
                                                        [(ngModel)]="machine_number" name="machine_number"
                                                        ngDefaultControl>
                                                </mat-form-field>
                                                <button mat-button class="btn-normal-none"
                                                    (click)="uploadAntivirusSoftwareDatas()">儲存</button>
                                                <button mat-button class="btn-normal"
                                                    (click)="CancelDatas()">取消</button>
                                            </div>
                                        </div>
                                        <div class="row">
                                            <div class="col">
                                                <table mat-table [dataSource]="antivirussoftwareSource">
                                                    
                                                    <ng-container matColumnDef="as_name">
                                                        <th mat-header-cell *matHeaderCellDef>軟體名稱</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.as_name}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="software_number">
                                                        <th mat-header-cell *matHeaderCellDef>軟體序號</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.software_number}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="machine_number">
                                                        <th mat-header-cell *matHeaderCellDef>機台序號</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.machine_number}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="create_time">
                                                        <th mat-header-cell *matHeaderCellDef>建檔日期</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.create_time | date: 'yyyy/MM/dd hh:mm'}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="status">
                                                        <th mat-header-cell *matHeaderCellDef>狀態</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.status}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="delete">
                                                        <th mat-header-cell *matHeaderCellDef class="text-center">
                                                            刪除 </th>
                                                        <td mat-cell *matCellDef="let element;let index = index"
                                                            class="text-center">
                                                            <button mat-mini-fab color="basic" class="table-btn-none"
                                                                (click)="deleteAntivirusSoftwareDatas(element.as_id)">
                                                                <mat-icon>delete</mat-icon>
                                                            </button>
                                                        </td>
                                                    </ng-container>
                                                    <tr mat-header-row *matHeaderRowDef="antivirussoftwareColumns">
                                                    </tr>
                                                    <tr mat-row
                                                        *matRowDef="let row; columns: antivirussoftwareColumns;">
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p-tabPanel>
                            <p-tabPanel header="待主管審核軟體(測試)" *ngIf="review">
                                <div class="table-container">
                                    <div class="table text-left">
                                        <div class="row">
                                            <div class="col">
                                                <table mat-table [dataSource]="reviewantivirussoftwareSource">
                                                    
                                                    <ng-container matColumnDef="as_name">
                                                        <th mat-header-cell *matHeaderCellDef>軟體名稱</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.as_name}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="software_number">
                                                        <th mat-header-cell *matHeaderCellDef>軟體序號</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.software_number}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="machine_number">
                                                        <th mat-header-cell *matHeaderCellDef>機台序號</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.machine_number}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="create_time">
                                                        <th mat-header-cell *matHeaderCellDef>建檔日期</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.create_time | date: 'yyyy/MM/dd hh:mm'}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="status">
                                                        <th mat-header-cell *matHeaderCellDef>狀態</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            {{element.status}}
                                                        </td>
                                                    </ng-container>
                                                    
                                                    <ng-container matColumnDef="review">
                                                        <th mat-header-cell *matHeaderCellDef>審核</th>
                                                        <td mat-cell *matCellDef="let element">
                                                            <button mat-mini-fab color="basic" class="table-btn-none"
                                                                (click)="renewAntivirusSoftwareDatas(element.as_id,element.bonita_task_id)">
                                                                <mat-icon>check</mat-icon>
                                                            </button>
                                                        </td>
                                                    </ng-container>

                                                    <tr mat-header-row
                                                        *matHeaderRowDef="reviewantivirussoftwareColumns">
                                                    </tr>
                                                    <tr mat-row
                                                        *matRowDef="let row; columns: reviewantivirussoftwareColumns;">
                                                    </tr>
                                                </table>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </p-tabPanel> -->
                            <!-- 尚未開放 -->
                            <p-tabPanel header="附贈明細" *ngIf="">
                                <div class="row mt-3">
                                    <mat-form-field appearance="outline" style="width:400px">
                                        <mat-label>附贈說明</mat-label>
                                        <input matInput type="text" #filter placeholder="">
                                    </mat-form-field>
                                </div>
                                <div class="row mt-5">
                                    <mat-form-field appearance="outline" style="width:175px;">
                                        <mat-label>品號</mat-label>
                                        <input matInput type="text" #filter placeholder="請輸入關鍵字">
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" style="width:200px;">
                                        <mat-label>品名</mat-label>
                                        <input matInput type="text" #filter placeholder="請輸入關鍵字">
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" style="width:350px;">
                                        <mat-label>規格</mat-label>
                                        <input matInput type="text" #filter placeholder="請輸入關鍵字">
                                    </mat-form-field>
                                    <mat-form-field appearance="outline" style="width:100px;">
                                        <mat-label>數量</mat-label>
                                        <input matInput type="text" #filter placeholder="請輸入關鍵字">
                                    </mat-form-field>
                                </div>
                                <div class="row mt-2">
                                    <div class="table-container">
                                        <div class="table text-left">
                                            <table mat-table [dataSource]="dataSource_7_1"
                                                class="mat-elevation-z8 demo-table">

                                                <!-- item_number Column -->
                                                <ng-container matColumnDef="item_number">
                                                    <th mat-header-cell *matHeaderCellDef>品號</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.item_number}}</td>
                                                </ng-container>

                                                <!-- product_id Column -->
                                                <ng-container matColumnDef="product_id">
                                                    <th mat-header-cell *matHeaderCellDef>品名</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.product_id}}</td>
                                                </ng-container>

                                                <!-- specification Column -->
                                                <ng-container matColumnDef="specification">
                                                    <th mat-header-cell *matHeaderCellDef>規格</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.specification}}</td>
                                                </ng-container>

                                                <!-- quantity_7 Column -->
                                                <ng-container matColumnDef="quantity_7">
                                                    <th mat-header-cell *matHeaderCellDef>數量</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.quantity_7}}</td>
                                                </ng-container>


                                                <tr mat-header-row *matHeaderRowDef="displayedColumns_7_1"></tr>
                                                <tr mat-row [class.demo-row-is-clicked]="clickedRows_7_1.has(row)"
                                                    *matRowDef="let row; columns: displayedColumns_7_1;"></tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mt-5">
                                    <div class="table-container">
                                        <div class="table text-left">
                                            <table mat-table [dataSource]="dataSource_7_2"
                                                class="mat-elevation-z8 demo-table">

                                                <!-- requisiton_number Column -->
                                                <ng-container matColumnDef="requisiton_number">
                                                    <th mat-header-cell *matHeaderCellDef>申請單號</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.requisiton_number}}</td>
                                                </ng-container>

                                                <!-- application_date Column -->
                                                <ng-container matColumnDef="application_date">
                                                    <th mat-header-cell *matHeaderCellDef>申請日期</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.application_date}}</td>
                                                </ng-container>

                                                <!-- applicant Column -->
                                                <ng-container matColumnDef="applicant">
                                                    <th mat-header-cell *matHeaderCellDef>申請者</th>
                                                    <td mat-cell *matCellDef="let element">{{element.applicant}}
                                                    </td>
                                                </ng-container>

                                                <!-- file_creator Column -->
                                                <ng-container matColumnDef="file_creator">
                                                    <th mat-header-cell *matHeaderCellDef>建檔者</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.file_creator}}</td>
                                                </ng-container>

                                                <!-- customer Column -->
                                                <ng-container matColumnDef="customer">
                                                    <th mat-header-cell *matHeaderCellDef>客戶別</th>
                                                    <td mat-cell *matCellDef="let element">{{element.customer}}
                                                    </td>
                                                </ng-container>

                                                <!-- project_code_7 Column -->
                                                <ng-container matColumnDef="project_code_7">
                                                    <th mat-header-cell *matHeaderCellDef>專案代號</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.project_code_7}}</td>
                                                </ng-container>

                                                <!-- requisition Column -->
                                                <ng-container matColumnDef="requisition">
                                                    <th mat-header-cell *matHeaderCellDef>請購單號</th>
                                                    <td mat-cell *matCellDef="let element">
                                                        {{element.requisition}}</td>
                                                </ng-container>

                                                <!-- apply Column -->
                                                <ng-container matColumnDef="apply">
                                                    <th mat-header-cell *matHeaderCellDef>申請</th>
                                                    <td mat-cell *matCellDef="let element">{{element.apply}}
                                                    </td>
                                                </ng-container>

                                                <!-- purchase Column -->
                                                <ng-container matColumnDef="purchase">
                                                    <th mat-header-cell *matHeaderCellDef>採購</th>
                                                    <td mat-cell *matCellDef="let element">{{element.purchase}}
                                                    </td>
                                                </ng-container>

                                                <!-- state Column -->
                                                <ng-container matColumnDef="state">
                                                    <th mat-header-cell *matHeaderCellDef>狀態</th>
                                                    <td mat-cell *matCellDef="let element">{{element.state}}
                                                    </td>
                                                </ng-container>

                                                <tr mat-header-row *matHeaderRowDef="displayedColumns_7_2"></tr>
                                                <tr mat-row [class.demo-row-is-clicked]="clickedRows_7_2.has(row)"
                                                    *matRowDef="let row; columns: displayedColumns_7_2;"></tr>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </p-tabPanel>
                        </p-tabView>
                    </mat-card>
                </div>
            </div>
        </div>
    </form>
</div>